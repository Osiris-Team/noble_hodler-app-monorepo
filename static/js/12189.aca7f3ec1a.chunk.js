"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[12189],{326745:(e,n,t)=>{t.d(n,{u:()=>useAppRoute});var a=t(654266);function useAppRoute(){return(0,a.lq)()}},713989:(e,n,t)=>{t.d(n,{G:()=>StakeShouldUnderstand,a:()=>WithdrawShouldUnderstand});var a=t(908867),r=t(490343),i=t(254491),o=t(905817),s=t(831085),ShouldUnderstandListItemListItem=function({title:e,description:n,index:t}){return(0,s.jsxs)(r.YStack,{children:[(0,s.jsxs)(r.XStack,{children:[(0,s.jsx)(r.Stack,{w:"$5",children:(0,s.jsxs)(r.SizableText,{children:[t,"."]})}),(0,s.jsx)(r.Stack,{flex:1,children:(0,s.jsx)(r.SizableText,{children:e})})]}),n?(0,s.jsx)(r.XStack,{pl:"$5",children:(0,s.jsx)(r.SizableText,{children:n})}):null]})},ShouldUnderstand=function({title:e,logoURI:n,subtitle:t,items:a}){return(0,s.jsx)(r.YStack,{flex:1,children:(0,s.jsx)(r.ScrollView,{maxHeight:560,children:(0,s.jsx)(r.YStack,{pb:"$5",children:(0,s.jsxs)(r.Stack,{children:[(0,s.jsx)(r.Image,{w:"$14",h:"$14",src:n}),(0,s.jsxs)(r.YStack,{mt:"$5",children:[(0,s.jsx)(r.SizableText,{size:"$headingXl",children:e}),t?(0,s.jsx)(r.XStack,{mt:"$5",children:(0,s.jsx)(r.SizableText,{size:"$bodyLg",children:t})}):null]}),(0,s.jsx)(r.YStack,{mt:"$5",gap:"$5",children:a.map((function(e,n){return(0,s.jsx)(ShouldUnderstandListItemListItem,{index:n+1,title:e.title,description:e.description},n)}))})]})})})})},createTypography=function(e,n){return n?e:""},StakeShouldUnderstand=function({provider:e,logoURI:n,symbol:t,apr:l,updateFrequency:c,receiveSymbol:u,unstakingPeriod:d}){var m=(0,a.A)(),b=[];return b="everstake"===e&&["sol","eth","apt"].includes(t)?[createTypography(m.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsxs)(r.SizableText,{color:"$textSuccess",children:[l,"%"]})}),l),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_updated_around_time},{time:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:c})}),c),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_automatically_restaked},{automatically:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:m.formatMessage({id:i.ETranslations.earn_automatically})})}),!0),createTypography(m.formatMessage({id:i.ETranslations.earn_withdrawal_up_to_number_days},{number:d}),d)]:"everstake"===e&&["atom","matic"].includes(t)?[createTypography(m.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsxs)(r.SizableText,{color:"$textSuccess",children:[l,"%"]})}),{number:l}),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_updated_around_time},{time:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:c})}),c),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_manually_restaked},{manually:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:m.formatMessage({id:i.ETranslations.earn_manually})})}),!0),createTypography(m.formatMessage({id:i.ETranslations.earn_withdrawal_up_to_number_days},{number:d}),d)]:"lido"===e&&["eth","matic"].includes(t)?[createTypography(m.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsxs)(r.SizableText,{color:"$textSuccess",children:[l,"%"]})}),l),createTypography(m.formatMessage({id:i.ETranslations.earn_receive_token_trade_anytime},{token:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:u})}),u),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_updated_around_time},{time:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:c})}),c),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_automatically_restaked},{automatically:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:m.formatMessage({id:i.ETranslations.earn_automatically})})}),!0),createTypography(m.formatMessage({id:i.ETranslations.earn_withdrawal_up_to_number_days},{number:d}),d)]:"babylon"===e?[m.formatMessage({id:i.ETranslations.earn_stake_through_onekey_earn_points}),m.formatMessage({id:i.ETranslations.earn_check_staking_results_overflow}),createTypography(m.formatMessage({id:i.ETranslations.earn_early_withdraw_stake_unstaking_period},{number:d}),d)]:[createTypography(m.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:null!=l?l:4})}),!0)],(0,s.jsx)(ShouldUnderstand,{logoURI:n,title:m.formatMessage({id:i.ETranslations.earn_provider_asset_staking},{provider:(0,o.c)(e),asset:t.toUpperCase()}),items:b.filter((function(e){return!!e})).map((function(e){return{title:e}}))})},WithdrawShouldUnderstand=function({provider:e,symbol:n,logoURI:t,withdrawalPeriod:r}){var l=(0,a.A)();return(0,s.jsx)(ShouldUnderstand,{logoURI:t,title:l.formatMessage({id:i.ETranslations.earn_provider_asset_withdrawal},{provider:(0,o.c)(e),asset:n.toUpperCase()}),items:[{title:l.formatMessage({id:i.ETranslations.earn_withdrawal_take_up_to_number_days},{number:r})},{title:l.formatMessage({id:i.ETranslations.earn_claim_assets_after_processing})}]})}},939799:(e,n,t)=>{t.d(n,{A:()=>ValuePriceListItem});var a=t(490343),r=t(831085),ValuePriceListItem=function({amount:e,tokenSymbol:n,fiatSymbol:t,fiatValue:i}){return(0,r.jsxs)(a.XStack,{gap:"$1",maxWidth:"$56",justifyContent:"flex-end",flexWrap:"wrap",children:[(0,r.jsx)(a.XStack,{children:(0,r.jsx)(a.NumberSizeableText,{size:"$bodyLgMedium",formatter:"balance",formatterOptions:{tokenSymbol:n},children:e})}),(0,r.jsx)(a.XStack,{maxWidth:"$56",children:i?(0,r.jsxs)(a.SizableText,{children:["(",(0,r.jsx)(a.NumberSizeableText,{size:"$bodyLgMedium",formatter:"value",formatterOptions:{currency:t},children:i}),")"]}):null})]})}},90393:(e,n,t)=>{t.d(n,{Z:()=>useProviderLabel});var a=t(908867),r=t(254491),useProviderLabel=function(e){var n=(0,a.A)(),t=n.formatMessage({id:r.ETranslations.global_protocol});return"everstake"===e.toLowerCase()?t=n.formatMessage({id:r.ETranslations.earn_validator}):"babylogn"===e.toLowerCase()&&(t=n.formatMessage({id:r.ETranslations.earn_finality_provider})),t}},653913:(e,n,t)=>{t.d(n,{B8:()=>useUniversalStake,D0:()=>useUniversalClaim,Pg:()=>useUniversalWithdraw});var a=t(586330),r=t(514041),i=t(610421),o=t(927799),s=t(897976),l=t(184251),c=t(714191),u=t(161024);function useUniversalStake({networkId:e,accountId:n}){var t,{navigationToSendConfirm:c}=(0,o.E)({accountId:n,networkId:e});return(0,r.useCallback)((t=(0,a.A)((function*({amount:t,symbol:a,term:r,provider:o,stakingInfo:u,onSuccess:d,onFail:m}){var b,p,f=yield i.A.serviceStaking.buildStakeTransaction({amount:t,networkId:e,accountId:n,symbol:a,term:r,provider:o}),g=yield s.rq.getVault({networkId:e,accountId:n}),k=yield g.buildStakeEncodedTx(f);l.A.isBTCNetwork(e)&&(b=!0,p=!1),yield c({encodedTx:k,stakingInfo:u,onSuccess:d,onFail:m,useFeeInTx:b,feeInfoEditable:p})})),function(e){return t.apply(this,arguments)}),[c,n,e])}function useUniversalWithdraw({networkId:e,accountId:n}){var t,{navigationToSendConfirm:l}=(0,o.E)({accountId:n,networkId:e});return(0,r.useCallback)((t=(0,a.A)((function*({amount:t,symbol:r,provider:o,identity:d,stakingInfo:m,onSuccess:b,onFail:p}){var f,g=yield i.A.serviceStaking.getStakingConfigs({networkId:e,symbol:r,provider:o});if(!g)throw new Error("Staking config not found");if(g?.unstakeWithSignMessage){var k=yield i.A.serviceAccount.getAccount({accountId:n,networkId:e}),{message:x,deadline:y}=yield i.A.serviceStaking.buildLidoEthPermitMessageData({accountId:n,networkId:e,amount:t}),_=yield i.A.serviceDApp.openSignMessageModal({accountId:n,networkId:e,request:{origin:"https://lido.fi/",scope:"ethereum"},unsignedMessage:{type:u.$.TYPED_DATA_V4,message:x,payload:[k.address,x]},sceneName:c.Zs.home});f=yield i.A.serviceStaking.buildUnstakeTransaction({amount:t,networkId:e,accountId:n,symbol:r,provider:o,signature:_,deadline:y})}else f=yield i.A.serviceStaking.buildUnstakeTransaction({amount:t,identity:d,networkId:e,accountId:n,symbol:r,provider:o});var S,h=yield s.rq.getVault({networkId:e,accountId:n}),T=yield h.buildStakeEncodedTx(f);yield l({encodedTx:T,stakingInfo:m,signOnly:g?.withdrawSignOnly,onSuccess:(S=(0,a.A)((function*(t){if(g?.withdrawSignOnly){var a=t[0].signedTx.finalizedPsbtHex;a&&d&&(yield i.A.serviceStaking.unstakePush({txId:d,networkId:e,accountId:n,symbol:r,provider:o,unstakeTxHex:a}),b?.(t))}else b?.(t)})),function onSuccess(e){return S.apply(this,arguments)}),onFail:p})})),function(e){return t.apply(this,arguments)}),[n,e,l])}function useUniversalClaim({networkId:e,accountId:n}){var t,{navigationToSendConfirm:l}=(0,o.E)({accountId:n,networkId:e});return(0,r.useCallback)((t=(0,a.A)((function*({identity:t,amount:a,provider:r,symbol:o,stakingInfo:c,onSuccess:u,onFail:d}){var m=yield i.A.serviceStaking.buildClaimTransaction({networkId:e,accountId:n,symbol:o,provider:r,amount:a,identity:t}),b=yield s.rq.getVault({networkId:e,accountId:n}),p=yield b.buildStakeEncodedTx(m);yield l({encodedTx:p,stakingInfo:c,onSuccess:u,onFail:d})})),function(e){return t.apply(this,arguments)}),[l,n,e])}},412189:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Stake});var a=t(586330),r=t(514041),i=t(908867),o=t(490343),s=t(498356),l=t(326745),c=t(254491),u=t(157572),d=t(567807),m=t(550082),b=t(324586),p=t(241440),f=t(88803),g=t(791088),k=t(259227),x=t(905817),y=t(713989),_=t(939799),S=t(831085);function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(t),!0).forEach((function(n){(0,b.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var h={color:"$textSubdued",size:"$bodyLg"},UniversalStake=function({price:e,balance:n,apr:t,details:s,decimals:l,minAmount:u="0",minTransactionFee:m="0",providerLabel:b,minStakeTerm:T,minStakeBlocks:v,tokenImageUri:w,tokenSymbol:j,providerName:I,providerLogo:M,isReachBabylonCap:E,showEstReceive:A,estReceiveToken:C,estReceiveTokenRate:$="1",isDisabled:P,maxAmount:z,onConfirm:N}){var O=(0,i.A)(),[U,R]=(0,r.useState)(!1),[F,L]=(0,r.useState)(""),[{currencyInfo:{symbol:B}}]=(0,k.useSettingsPersistAtom)(),D=(0,r.useCallback)((function(e){if(new p.A(e).isNaN())""===e&&L("");else{var n=Boolean(l&&Number(l)>0&&(0,x.FZ)(e)>l);L(n?function(e){return e}:e)}}),[l]),Y=(0,r.useCallback)((function(){var e=new p.A(n).minus(m);e.gt(0)?D(e.toFixed()):D(n)}),[D,n,m]),q=(0,r.useMemo)((function(){if(Number(F)>0&&Number(e)>0)return new p.A(F).multipliedBy(e).toFixed()}),[F,e]),X=(0,r.useMemo)((function(){return new p.A(F).gt(n)}),[F,n]),W=(0,r.useMemo)((function(){var e=new p.A(u),n=new p.A(F);return!(!e.isGreaterThan(0)||!n.isGreaterThan(0))&&n.isLessThan(e)}),[u,F]),V=(0,r.useMemo)((function(){return!!(z&&Number(z)>0&&Number(F)>0)&&new p.A(F).isGreaterThan(z)}),[z,F]),G=(0,r.useMemo)((function(){var e=(0,p.A)(F);return e.isNaN()||e.isLessThanOrEqualTo(0)||X||W||E}),[F,X,W,E]),Z=(0,r.useMemo)((function(){if(Number(F)>0&&Number(t)>0){var n=(0,p.A)(F).multipliedBy(null!=t?t:0).dividedBy(100);return(0,S.jsx)(_.A,{amount:n.toFixed(),tokenSymbol:null!=j?j:"",fiatSymbol:B,fiatValue:Number(e)>0?n.multipliedBy(e).toFixed():void 0})}return null}),[F,t,e,B,j]),H=(0,r.useMemo)((function(){if(T&&Number(T)>0&&v){var e=Math.ceil(T/864e5);return O.formatMessage({id:c.ETranslations.earn_number_days_number_block},{number_days:e,number:v})}return null}),[T,v,O]),K=(0,r.useMemo)((function(){if(T){var e=new Date,n=new Date(e.getTime()+T);return(0,d.Yq)(n,{hideTimeForever:!0})}return null}),[T]),J=(0,r.useCallback)((0,a.A)((function*(){var e;o.Dialog.show({renderContent:(0,S.jsx)(y.G,{provider:s.provider.name.toLowerCase(),symbol:s.token.info.symbol.toLowerCase(),logoURI:s.token.info.logoURI,apr:s.provider.apr,updateFrequency:s.updateFrequency,unstakingPeriod:s.unstakingPeriod,receiveSymbol:s.rewardToken}),onConfirm:(e=(0,a.A)((function*(e){try{R(!0),yield e.close(),yield N?.(F)}finally{R(!1)}})),function onConfirm(n){return e.apply(this,arguments)}),onConfirmText:O.formatMessage({id:c.ETranslations.earn_stake}),showCancelButton:!1})})),[N,F,s,O]);return(0,S.jsxs)(o.YStack,{children:[(0,S.jsxs)(o.Stack,{mx:"$2",px:"$3",gap:"$5",children:[(0,S.jsxs)(o.Stack,{position:"relative",opacity:P?.7:1,children:[(0,S.jsx)(f.J,{bg:P?"$bgDisabled":"$bgApp",hasError:X||W,value:F,onChange:D,tokenSelectorTriggerProps:{selectedTokenImageUri:w,selectedTokenSymbol:j?.toUpperCase()},balanceProps:{value:n,onPress:Y},inputProps:{placeholder:"0"},valueProps:{value:q,currency:q?B:void 0},enableMaxAmount:!0}),P?(0,S.jsx)(o.Stack,{position:"absolute",w:"100%",h:"100%"}):null]}),(0,S.jsxs)(o.YStack,{gap:"$1",children:[W?(0,S.jsx)(o.Alert,{icon:"InfoCircleOutline",type:"critical",title:O.formatMessage({id:c.ETranslations.earn_minimum_amount},{number:u,symbol:j})}):null,X?(0,S.jsx)(o.Alert,{icon:"InfoCircleOutline",type:"critical",title:O.formatMessage({id:c.ETranslations.earn_insufficient_balance})}):null,V?(0,S.jsx)(o.Alert,{icon:"InfoCircleOutline",type:"critical",title:O.formatMessage({id:c.ETranslations.earn_maximum_staking_alert},{number:null!=z?z:"",symbol:j})}):null,E?(0,S.jsx)(o.Alert,{icon:"InfoCircleOutline",type:"critical",title:O.formatMessage({id:c.ETranslations.earn_reaching_staking_cap})}):null]})]}),(0,S.jsx)(o.Stack,{children:(0,S.jsxs)(o.YStack,{children:[Z?(0,S.jsx)(g.c,{title:O.formatMessage({id:c.ETranslations.earn_est_annual_rewards}),titleProps:h,children:Z}):null,A&&C&&Number(F)>0?(0,S.jsx)(g.c,{title:O.formatMessage({id:c.ETranslations.earn_est_receive}),titleProps:h,children:(0,S.jsx)(o.SizableText,{children:(0,S.jsx)(o.NumberSizeableText,{formatter:"balance",size:"$bodyLgMedium",formatterOptions:{tokenSymbol:C},children:(0,p.A)(F).multipliedBy($).toFixed()})})}):null,t&&Number(t)>0?(0,S.jsx)(g.c,{title:O.formatMessage({id:c.ETranslations.global_apr}),titleProps:h,children:(0,S.jsx)(g.c.Text,{primary:`${t}%`,primaryTextProps:{color:"$textSuccess"}})}):null,H?(0,S.jsxs)(g.c,{children:[(0,S.jsxs)(o.XStack,{flex:1,alignItems:"center",gap:"$1",children:[(0,S.jsx)(o.SizableText,_objectSpread(_objectSpread({},h),{},{children:O.formatMessage({id:c.ETranslations.earn_term})})),(0,S.jsx)(o.Popover,{title:O.formatMessage({id:c.ETranslations.earn_term}),renderTrigger:(0,S.jsx)(o.IconButton,{iconColor:"$iconSubdued",size:"small",icon:"InfoCircleOutline",variant:"tertiary"}),renderContent:(0,S.jsx)(o.Stack,{p:"$5",children:(0,S.jsx)(o.SizableText,{children:O.formatMessage({id:c.ETranslations.earn_term_tooltip})})})})]}),(0,S.jsx)(g.c.Text,{primary:H})]}):null,K?(0,S.jsx)(g.c,{title:O.formatMessage({id:c.ETranslations.earn_unlock_time}),titleProps:h,children:(0,S.jsx)(g.c.Text,{primary:K})}):null,M&&I?(0,S.jsx)(g.c,{title:null!=b?b:O.formatMessage({id:c.ETranslations.global_protocol}),titleProps:h,children:(0,S.jsxs)(o.XStack,{gap:"$2",alignItems:"center",children:[(0,S.jsx)(o.Image,{width:"$5",height:"$5",src:M,borderRadius:"$2"}),(0,S.jsx)(o.SizableText,{size:"$bodyLgMedium",children:(0,x.c)(I)})]})}):null]})}),(0,S.jsx)(o.Page.Footer,{onConfirmText:O.formatMessage({id:c.ETranslations.global_continue}),confirmButtonProps:{onPress:J,loading:U,disabled:G}})]})},T=t(90393),v=t(653913);const Stake=function(){var e,n=(0,l.u)(),{accountId:t,networkId:b,details:p,onSuccess:f}=n.params,{token:g,provider:k,rewardToken:y}=p,{balanceParsed:_,price:h}=g,w=g.info,j=(0,x.Y)(p),I=(0,r.useMemo)((function(){if(k?.minStakeTerm)return(0,d.XG)(k.minStakeTerm)}),[k]),M=(0,v.B8)({accountId:t,networkId:b}),E=(0,s.A)(),A=(0,r.useCallback)((e=(0,a.A)((function*(e){yield M({amount:e,symbol:w.symbol.toUpperCase(),provider:k.name,stakingInfo:{label:m.D.Stake,protocol:k.name,send:{token:w,amount:e},tags:[j]},term:I,onSuccess:function(){E.pop(),u.U.staking.page.staking({token:w,stakingProtocol:k.name}),f?.()}})})),function(n){return e.apply(this,arguments)}),[M,E,w,k,j,f,I]),C=(0,i.A)(),$=(0,T.Z)(k.name),P=(0,r.useMemo)((function(){if(k&&"babylon"===k.name){var{stakingCap:e,totalStaked:n}=k;return Number(e)>0&&Number(n)>0&&Number(n)>Number(e)}return!1}),[k]),z=(0,r.useMemo)((function(){return"lido"===k.name.toLowerCase()}),[k]);return(0,S.jsxs)(o.Page,{children:[(0,S.jsx)(o.Page.Header,{title:C.formatMessage({id:c.ETranslations.earn_stake_token},{token:w.symbol})}),(0,S.jsx)(o.Page.Body,{children:(0,S.jsx)(UniversalStake,{decimals:p.token.info.decimals,details:p,apr:Number(k.apr)>0?k.apr:void 0,price:h,balance:_,minAmount:k.minStakeAmount,maxAmount:k.maxStakeAmount,minStakeTerm:k.minStakeTerm,minStakeBlocks:k.minStakeBlocks,tokenImageUri:w.logoURI,tokenSymbol:w.symbol,providerLogo:k.logoURI,providerName:k.name,providerLabel:$,isReachBabylonCap:P,isDisabled:P,showEstReceive:z,estReceiveToken:y,estReceiveTokenRate:k.lidoStTokenRate,onConfirm:A,minTransactionFee:k.minTransactionFee})})]})}},905817:(e,n,t)=>{t.d(n,{FZ:()=>countDecimalPlaces,Y:()=>buildLocalTxStatusSyncId,c:()=>capitalizeString});var buildLocalTxStatusSyncId=function(e){return`${e.provider.name.toLowerCase()}-${e.token.info.symbol.toLowerCase()}`};function capitalizeString(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e}function countDecimalPlaces(e){var n="string"==typeof e?Number(e):e;if(Number.isNaN(n))return 0;var t=n.toString(),a=t.indexOf(".");return-1===a?0:t.length-a-1}},550082:(e,n,t)=>{t.d(n,{D:()=>a});var a=function(e){return e.Stake="Stake",e.Claim="Claim",e.Redeem="Redeem",e.Withdraw="Withdraw",e.Unknown="Unknown",e}({});!function(e){e.EthEvertStake="eth-evert-stake",e.EthLido="eth-lido",e.BtcBabylon="btc-babylon"}({})}}]);