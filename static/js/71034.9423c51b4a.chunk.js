"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[71034],{714519:(e,t,n)=>{n.d(t,{t:()=>showNotificationPermissionsDialog});var i=n(586330),s=n(490343),r=n(276360),o=n(610421),c=n(831085),showNotificationPermissionsDialog=function(){return s.Dialog.show({title:"通知权限",renderContent:(0,c.jsxs)(s.Stack,{children:[(0,c.jsx)(s.SizableText,{children:"手动开启权限的步骤引导： 1、2、3"}),(0,c.jsx)(s.SizableText,{children:"更多详情，请查看帮助中心 →"}),(0,c.jsx)(s.Button,{onPress:function(){o.A.serviceNotification.openPermissionSettings()},children:"前往权限设置页 → （部分端可能无法跳转，或跳转错误）"}),(0,c.jsx)(s.Button,{onPress:function(){o.A.serviceNotification.showNotification({title:"test message",description:"This is a test message"})},children:"消息测试"})]}),onConfirmText:"开启权限",onConfirm:(e=(0,i.A)((function*({close:e,preventClose:t}){t(),(yield o.A.serviceNotification.enableNotificationPermissions()).permission===r.cf.granted&&(yield e())})),function onConfirm(t){return e.apply(this,arguments)})});var e}},571034:(e,t,n)=>{n.r(t),n.d(t,{default:()=>NotificationsSettings});var i=n(324586),s=n(586330),r=n(579071),o=n.n(r),c=n(514041),a=n(908867),l=n(578104),u=n(490343),f=n(610421),d=n(791088),p=n(714519),h=n(911998),b=n(259227),j=n(254491),g=(n(663522),n(831085));function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function NotificationsSettings(){var e,t,n=(0,a.A)(),[i,r]=(0,c.useState)(),[y]=(0,b.useDevSettingsPersistAtom)(),[x]=(0,b.useSettingsPersistAtom)(),v=(0,c.useRef)(),{result:m}=(0,h.yk)((function(){return o()(y.enabled),f.A.serviceNotification.getPushClient()}),[y.enabled]),P=(0,c.useCallback)((0,s.A)((function*(){var e=yield f.A.serviceNotification.fetchNotificationSettings();r(e),v.current=e})),[]),S=(0,l.YQ)((e=(0,s.A)((function*(e){var t=!1;try{t=yield f.A.serviceNotification.updateNotificationSettings(_objectSpread(_objectSpread({},i),e))}catch(e){throw v.current&&r(v.current),e}t&&(yield P())})),function(t){return e.apply(this,arguments)}),300,{leading:!1,trailing:!0}),w=(0,c.useCallback)((t=(0,s.A)((function*(e){r((function(t){return _objectSpread(_objectSpread({},t),e)})),S(e)})),function(e){return t.apply(this,arguments)}),[S]);return(0,c.useEffect)((function(){P()}),[P]),(0,g.jsxs)(u.Page,{children:[(0,g.jsx)(u.Page.Header,{title:n.formatMessage({id:j.ETranslations.global_notifications})}),(0,g.jsxs)(u.Page.Body,{children:[i?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(d.c,{children:[(0,g.jsx)(d.c.Text,{flex:1,primary:n.formatMessage({id:j.ETranslations.notifications_notifications_switch_label})}),(0,g.jsx)(u.Switch,{value:!!i?.pushEnabled,onChange:function(e){w({pushEnabled:e})}})]}),i?.pushEnabled?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(u.Button,{onPress:p.t,children:"通知权限"}),(0,g.jsx)(u.Divider,{m:"$5"}),(0,g.jsxs)(d.c,{children:[(0,g.jsx)(d.c.Text,{flex:1,primary:n.formatMessage({id:j.ETranslations.notifications_notifications_account_activity_label}),secondary:n.formatMessage({id:j.ETranslations.notifications_notifications_account_activity_desc}),secondaryTextProps:{maxWidth:"$96"}}),(0,g.jsx)(u.Switch,{value:!!i?.accountActivityPushEnabled,onChange:function(e){w({accountActivityPushEnabled:e})}})]})]}):null]}):(0,g.jsx)(u.Stack,{pt:240,justifyContent:"center",alignItems:"center",children:(0,g.jsx)(u.Spinner,{size:"large"})}),null]})]})}}}]);