"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[71572],{326745:(e,n,t)=>{t.d(n,{u:()=>useAppRoute});var o=t(654266);function useAppRoute(){return(0,o.lq)()}},939799:(e,n,t)=>{t.d(n,{A:()=>ValuePriceListItem});var o=t(490343),a=t(831085),ValuePriceListItem=function({amount:e,tokenSymbol:n,fiatSymbol:t,fiatValue:r}){return(0,a.jsxs)(o.XStack,{gap:"$1",maxWidth:"$56",justifyContent:"flex-end",flexWrap:"wrap",children:[(0,a.jsx)(o.XStack,{children:(0,a.jsx)(o.NumberSizeableText,{size:"$bodyLgMedium",formatter:"balance",formatterOptions:{tokenSymbol:n},children:e})}),(0,a.jsx)(o.XStack,{maxWidth:"$56",children:r?(0,a.jsxs)(o.SizableText,{children:["(",(0,a.jsx)(o.NumberSizeableText,{size:"$bodyLgMedium",formatter:"value",formatterOptions:{currency:t},children:r}),")"]}):null})]})}},653913:(e,n,t)=>{t.d(n,{B8:()=>useUniversalStake,D0:()=>useUniversalClaim,Pg:()=>useUniversalWithdraw});var o=t(586330),a=t(514041),r=t(610421),i=t(927799),s=t(897976),c=t(184251),l=t(714191),u=t(161024);function useUniversalStake({networkId:e,accountId:n}){var t,{navigationToSendConfirm:l}=(0,i.E)({accountId:n,networkId:e});return(0,a.useCallback)((t=(0,o.A)((function*({amount:t,symbol:o,term:a,provider:i,stakingInfo:u,onSuccess:d,onFail:m}){var f,k,p=yield r.A.serviceStaking.buildStakeTransaction({amount:t,networkId:e,accountId:n,symbol:o,term:a,provider:i}),g=yield s.rq.getVault({networkId:e,accountId:n}),v=yield g.buildStakeEncodedTx(p);c.A.isBTCNetwork(e)&&(f=!0,k=!1),yield l({encodedTx:v,stakingInfo:u,onSuccess:d,onFail:m,useFeeInTx:f,feeInfoEditable:k})})),function(e){return t.apply(this,arguments)}),[l,n,e])}function useUniversalWithdraw({networkId:e,accountId:n}){var t,{navigationToSendConfirm:c}=(0,i.E)({accountId:n,networkId:e});return(0,a.useCallback)((t=(0,o.A)((function*({amount:t,symbol:a,provider:i,identity:d,stakingInfo:m,onSuccess:f,onFail:k}){var p,g=yield r.A.serviceStaking.getStakingConfigs({networkId:e,symbol:a,provider:i});if(!g)throw new Error("Staking config not found");if(g?.unstakeWithSignMessage){var v=yield r.A.serviceAccount.getAccount({accountId:n,networkId:e}),{message:y,deadline:b}=yield r.A.serviceStaking.buildLidoEthPermitMessageData({accountId:n,networkId:e,amount:t}),I=yield r.A.serviceDApp.openSignMessageModal({accountId:n,networkId:e,request:{origin:"https://lido.fi/",scope:"ethereum"},unsignedMessage:{type:u.$.TYPED_DATA_V4,message:y,payload:[v.address,y]},sceneName:l.Zs.home});p=yield r.A.serviceStaking.buildUnstakeTransaction({amount:t,networkId:e,accountId:n,symbol:a,provider:i,signature:I,deadline:b})}else p=yield r.A.serviceStaking.buildUnstakeTransaction({amount:t,identity:d,networkId:e,accountId:n,symbol:a,provider:i});var w,A=yield s.rq.getVault({networkId:e,accountId:n}),x=yield A.buildStakeEncodedTx(p);yield c({encodedTx:x,stakingInfo:m,signOnly:g?.withdrawSignOnly,onSuccess:(w=(0,o.A)((function*(t){if(g?.withdrawSignOnly){var o=t[0].signedTx.finalizedPsbtHex;o&&d&&(yield r.A.serviceStaking.unstakePush({txId:d,networkId:e,accountId:n,symbol:a,provider:i,unstakeTxHex:o}),f?.(t))}else f?.(t)})),function onSuccess(e){return w.apply(this,arguments)}),onFail:k})})),function(e){return t.apply(this,arguments)}),[n,e,c])}function useUniversalClaim({networkId:e,accountId:n}){var t,{navigationToSendConfirm:c}=(0,i.E)({accountId:n,networkId:e});return(0,a.useCallback)((t=(0,o.A)((function*({identity:t,amount:o,provider:a,symbol:i,stakingInfo:l,onSuccess:u,onFail:d}){var m=yield r.A.serviceStaking.buildClaimTransaction({networkId:e,accountId:n,symbol:i,provider:a,amount:o,identity:t}),f=yield s.rq.getVault({networkId:e,accountId:n}),k=yield f.buildStakeEncodedTx(m);yield c({encodedTx:k,stakingInfo:l,onSuccess:u,onFail:d})})),function(e){return t.apply(this,arguments)}),[c,n,e])}},671572:(e,n,t)=>{t.r(n),t.d(n,{default:()=>pages_ApproveBaseStake});var o=t(586330),a=t(514041),r=t(908867),i=t(490343),s=t(498356),c=t(326745),l=t(254491),u=t(157572),d=t(550082),m=t(241440),f=t(610421),k=t(88803),p=t(791088),g=t(391944),v=t(927799),y=t(259227),b=t(584186),I=t(369387);function useTrackTokenAllowance({networkId:e,accountId:n,initialValue:t,tokenAddress:r,spenderAddress:i}){var[s,c]=(0,a.useState)(t),[l,u]=(0,a.useState)(""),[d,m]=(0,a.useState)(),k=function useTxTrack({trackTxId:e,accountId:n,networkId:t,timeout:r=b.A.getTimeDurationMs({minute:60}),interval:i=b.A.getTimeDurationMs({seconds:30})}){var[s,c]=(0,a.useState)(null),l=(0,a.useRef)();return(0,a.useEffect)((function(){if(e){var a,s=Date.now(),u=(a=(0,o.A)((function*(e){var o=yield f.A.serviceHistory.fetchTxDetails({networkId:t,accountId:n,txid:e});o&&o.data&&o.data.status!==I.uU.Pending?c(o):Date.now()-s<r?l.current=setTimeout((function(){return u(e)}),i):c(null)})),function checkTxDetails(e){return a.apply(this,arguments)});return l.current=setTimeout((function(){return u(e)}),0),function(){return clearTimeout(l.current)}}}),[e,t,n,r,i]),s}({accountId:n,networkId:e,trackTxId:l});return(0,a.useEffect)((function(){function _fetchAllowance(){return(_fetchAllowance=(0,o.A)((function*(){if(k)try{var t=yield f.A.serviceStaking.fetchTokenAllowance({networkId:e,accountId:n,tokenAddress:r,spenderAddress:i});t&&c(t.allowanceParsed)}finally{m(!1)}else m(!1)}))).apply(this,arguments)}!function fetchAllowance(){return _fetchAllowance.apply(this,arguments)}()}),[k,e,n,i,r]),{allowance:s,trackAllowance:(0,a.useCallback)((function(e){u(e),m(!0)}),[u]),loading:d}}var w=t(905817),A=t(939799),x=t(831085),S={color:"$textSubdued",size:"$bodyLg"},ApproveBaseStake=function({price:e,balance:n,token:t,apr:s,decimals:c,minAmount:u="0",currentAllowance:d="0",providerName:b,providerLogo:I,onConfirm:T,approveTarget:h,showEstReceive:C,estReceiveToken:j,estReceiveTokenRate:M="1"}){var E=(0,r.A)(),{navigationToSendConfirm:P}=(0,v.E)({accountId:h.accountId,networkId:h.networkId}),[N,_]=(0,a.useState)(!1),[U,$]=(0,a.useState)(!1),{allowance:R,loading:z,trackAllowance:D}=useTrackTokenAllowance({accountId:h.accountId,networkId:h.networkId,tokenAddress:h.token.address,spenderAddress:h.spenderAddress,initialValue:d}),[F,B]=(0,a.useState)(""),[{currencyInfo:{symbol:L}}]=(0,y.useSettingsPersistAtom)(),O=(0,a.useCallback)((function(e){if(new m.A(e).isNaN())""===e&&B("");else{var n=Boolean(c&&Number(c)>0&&(0,w.FZ)(e)>c);B(n?function(e){return e}:e)}}),[c]),V=(0,a.useMemo)((function(){var n=new m.A(F);if(!n.isNaN())return n.multipliedBy(e).toFixed()}),[F,e]),W=(0,a.useMemo)((function(){return new m.A(F).gt(n)}),[F,n]),Y=(0,a.useMemo)((function(){var e=new m.A(u),n=new m.A(F);return!(!e.isGreaterThan(0)||!n.isGreaterThan(0))&&n.isLessThan(e)}),[u,F]),q=(0,a.useMemo)((function(){var e=(0,m.A)(F);return e.isNaN()||e.lte(0)||W||Y}),[F,W,Y]),H=(0,a.useMemo)((function(){var e=(0,m.A)(F),n=new m.A(R);return!e.isNaN()&&n.lt(F)}),[F,R]),X=(0,a.useMemo)((function(){return H?E.formatMessage({id:l.ETranslations.form__approve_str},{amount:F,symbol:t.symbol.toUpperCase()}):E.formatMessage({id:l.ETranslations.earn_stake})}),[H,t,F,E]),Z=(0,a.useCallback)((0,o.A)((function*(){$(!0);var e=yield f.A.serviceAccount.getAccount({accountId:h.accountId,networkId:h.networkId});yield P({approveInfo:{owner:e.address,spender:h.spenderAddress,amount:F,tokenInfo:h.token},onSuccess(e){D(e[0].decodedTx.txid),$(!1)},onFail(){$(!1)},onCancel(){$(!1)}})})),[F,h,P,D]),G=(0,a.useCallback)((0,o.A)((function*(){_(!0);try{yield T?.(F)}finally{_(!1)}})),[T,F]),J=(0,a.useCallback)((function(){O(n)}),[O,n]),K=(0,a.useMemo)((function(){if(Number(F)>0&&s&&Number(s)>0){var n=(0,m.A)(F).multipliedBy(s).dividedBy(100);return(0,x.jsx)(A.A,{tokenSymbol:t.symbol,amount:n.toFixed(),fiatSymbol:L,fiatValue:Number(e)>0?n.multipliedBy(e).toFixed():void 0})}return null}),[F,s,e,L,t.symbol]);return(0,x.jsxs)(i.YStack,{children:[(0,x.jsxs)(i.Stack,{mx:"$2",px:"$3",gap:"$5",children:[(0,x.jsx)(k.J,{hasError:W||Y,value:F,onChange:O,tokenSelectorTriggerProps:{selectedTokenImageUri:t.logoURI,selectedTokenSymbol:t.symbol.toUpperCase()},balanceProps:{value:n,onPress:J},inputProps:{placeholder:"0"},valueProps:{value:V,currency:V?L:void 0},enableMaxAmount:!0}),(0,x.jsxs)(i.YStack,{children:[Y?(0,x.jsx)(i.Alert,{icon:"InfoCircleOutline",type:"critical",title:E.formatMessage({id:l.ETranslations.earn_minimum_amount},{number:`${u} ${t.symbol}`})}):null,W?(0,x.jsx)(i.Alert,{icon:"InfoCircleOutline",type:"critical",title:E.formatMessage({id:l.ETranslations.earn_insufficient_balance})}):null]})]}),(0,x.jsx)(i.Stack,{children:(0,x.jsxs)(i.YStack,{children:[K?(0,x.jsx)(p.c,{title:E.formatMessage({id:l.ETranslations.earn_est_annual_rewards}),titleProps:S,children:K}):null,C&&j&&Number(F)>0?(0,x.jsx)(p.c,{title:E.formatMessage({id:l.ETranslations.earn_est_receive}),titleProps:S,children:(0,x.jsx)(i.SizableText,{children:(0,x.jsx)(i.NumberSizeableText,{formatter:"balance",size:"$bodyLgMedium",formatterOptions:{tokenSymbol:j},children:(0,m.A)(F).multipliedBy(M).toFixed()})})}):null,s&&Number(s)>0?(0,x.jsx)(p.c,{title:E.formatMessage({id:l.ETranslations.global_apr}),titleProps:S,children:(0,x.jsx)(p.c.Text,{primary:`${s}%`,primaryTextProps:{color:"$textSuccess"}})}):null,b&&I?(0,x.jsx)(p.c,{title:E.formatMessage({id:l.ETranslations.global_protocol}),titleProps:S,children:(0,x.jsxs)(i.XStack,{gap:"$2",alignItems:"center",children:[(0,x.jsx)(g.o,{size:"xs",tokenImageUri:I}),(0,x.jsx)(i.SizableText,{size:"$bodyLgMedium",children:b})]})}):null]})}),(0,x.jsx)(i.Page.Footer,{onConfirmText:X,confirmButtonProps:{onPress:H?Z:G,loading:N||z||U,disabled:q}})]})},T=t(653913);const pages_ApproveBaseStake=function(){var e,n,t=(0,c.u)(),{networkId:m,accountId:f,details:k,currentAllowance:p}=t.params,{token:g,provider:v}=k,{balanceParsed:y,price:b}=g,I=(0,s.A)(),A=(0,w.Y)(k),S=(0,T.B8)({accountId:f,networkId:m}),h=(0,a.useCallback)((n=(0,o.A)((function*(e){yield S({amount:e,stakingInfo:{label:d.D.Unknown,protocol:v.name,send:{token:g.info,amount:e},tags:[A]},symbol:g.info.symbol.toUpperCase(),provider:v.name,onSuccess:function(){I.pop(),u.U.staking.page.staking({token:g.info,stakingProtocol:v.name})}})})),function(e){return n.apply(this,arguments)}),[g,I,S,v,A]),C=(0,r.A)(),j=(0,a.useMemo)((function(){return"lido"===v.name.toLowerCase()}),[v]);return(0,x.jsxs)(i.Page,{children:[(0,x.jsx)(i.Page.Header,{title:C.formatMessage({id:l.ETranslations.earn_stake_token},{token:g.info.symbol})}),(0,x.jsx)(i.Page.Body,{children:(0,x.jsx)(ApproveBaseStake,{price:b,balance:y,token:g.info,minAmount:v.minStakeAmount,decimals:g.info.decimals,onConfirm:h,apr:Number(v.apr)>0?v.apr:void 0,currentAllowance:p,providerLogo:k.provider.logoURI,providerName:k.provider.name,showEstReceive:j,estReceiveToken:k.rewardToken,estReceiveTokenRate:v.lidoStTokenRate,approveTarget:{accountId:f,networkId:m,spenderAddress:null!=(e=k.approveTarget)?e:"",token:g.info}})})]})}},905817:(e,n,t)=>{t.d(n,{FZ:()=>countDecimalPlaces,Y:()=>buildLocalTxStatusSyncId,c:()=>capitalizeString});var buildLocalTxStatusSyncId=function(e){return`${e.provider.name.toLowerCase()}-${e.token.info.symbol.toLowerCase()}`};function capitalizeString(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e}function countDecimalPlaces(e){var n="string"==typeof e?Number(e):e;if(Number.isNaN(n))return 0;var t=n.toString(),o=t.indexOf(".");return-1===o?0:t.length-o-1}},550082:(e,n,t)=>{t.d(n,{D:()=>o});var o=function(e){return e.Stake="Stake",e.Claim="Claim",e.Redeem="Redeem",e.Withdraw="Withdraw",e.Unknown="Unknown",e}({});!function(e){e.EthEvertStake="eth-evert-stake",e.EthLido="eth-lido",e.BtcBabylon="btc-babylon"}({})}}]);