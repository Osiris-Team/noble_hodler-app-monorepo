"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[89498],{309008:(e,t,r)=>{r.d(t,{o:()=>d});var o=r(324586),n=r(514041),i=r(325529),a=r(2577),s=r(597102),l=r(829561),c=r(831085);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,o.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d=(0,n.memo)((function(e){var{children:t,storeName:r}=e,o=(0,l.x6)(r),n=a.A.getOrCreateStore(o);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.H,_objectSpread({},o)),(0,c.jsx)(i.BY,{store:n,children:t})]})}));d.displayName="SwapProviderMirror"},589498:(e,t,r)=>{r.r(t),r.d(t,{default:()=>modal_SwapProviderSelectModal});var o=r(514041),n=r(654266),i=r(241440),a=r(908867),s=r(490343),l=r(498356),c=r(325529),d=r(259227),u=r(254491),m=r(58546),p=r(324586),b=r(839850),f=r(8904),g=r(17617),x=r(403144),S=r(831085),j=["providerLogo","lock"];function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,p.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function SwapProviderIcon(e){var{providerLogo:t,lock:r}=e,o=(0,b.A)(e,j),n=(0,a.A)();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(s.Image,_objectSpread(_objectSpread({size:"$10",borderRadius:"$2",delayMs:1e3},o),{},{children:[(0,S.jsx)(s.Image.Source,{source:{uri:t}}),(0,S.jsx)(s.Image.Fallback,{alignItems:"center",justifyContent:"center",bg:"$bgStrong",children:(0,S.jsx)(s.Icon,{name:"Image2MountainsSolid",color:"$iconDisabled"})})]})),r?(0,S.jsx)(s.Tooltip,{renderTrigger:(0,S.jsx)(s.Stack,{p:"$0.5",borderRadius:"$full",bg:"$bgSubdued",position:"absolute",right:"$-1",bottom:"$-1",children:(0,S.jsx)(s.Icon,{size:"$4",name:"LockOutline"})}),renderContent:(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$text",children:n.formatMessage({id:u.ETranslations.provider_approval_require})}),placement:"bottom-start"}):null]})}var h=r(391944);function SwapRoutePaths_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function SwapRoutePaths_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?SwapRoutePaths_ownKeys(Object(r),!0).forEach((function(t){(0,p.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SwapRoutePaths_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const v=(0,o.memo)((function({routeContent:e}){return(0,S.jsxs)(s.Stack,{pt:"$3.5",children:["string"==typeof e?(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$textSubdued",children:e}):null,Array.isArray(e)?(0,S.jsx)(S.Fragment,{children:e.map((function(e,t){return(0,S.jsxs)(s.XStack,SwapRoutePaths_objectSpread(SwapRoutePaths_objectSpread({},0!==t&&{mt:"$3.5"}),{},{justifyContent:"space-between",children:[(0,S.jsx)(s.XStack,{position:"absolute",top:0,left:0,right:0,h:"$3.5",alignItems:"flex-end",gap:"$1",children:(0,S.jsx)(s.XStack,{px:"$4",flex:1,gap:"$1",alignItems:"center",children:new Array(40).fill(null).map((function(e,t){return(0,S.jsx)(s.Stack,{h:"$0.5",bg:"$borderSubdued",flex:1},t)}))})}),e.map((function(e,t){var r="$"+(4+4*e.images.length);return(0,S.jsxs)(s.Stack,{alignItems:"center",children:[(0,S.jsx)(s.XStack,{bg:"$bgApp",maxWidth:r,children:e.images.map((function(e,t){return(0,S.jsx)(h.o,SwapRoutePaths_objectSpread({size:"sm",tokenImageUri:e.logoImageUri},0!==t&&{ml:"$-2.5"}),t)}))}),(0,S.jsx)(s.Stack,{maxWidth:"$16",$gtMd:{maxWidth:"$24"},children:(0,S.jsx)(s.SizableText,{pt:"$1.5",size:"$bodySmMedium",color:"$textSubdued",numberOfLines:1,children:e.label})})]},t)}))]}),t)}))}):null]})}));var y=["providerResult","currencySymbol","fromToken","fromTokenAmount","toToken","selected","disabled"];function SwapProviderListItem_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function SwapProviderListItem_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?SwapProviderListItem_ownKeys(Object(r),!0).forEach((function(t){(0,p.A)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SwapProviderListItem_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const $=(0,o.memo)((function(e){var{providerResult:t,currencySymbol:r,fromToken:n,fromTokenAmount:l,toToken:c,selected:d,disabled:m}=e,p=(0,b.A)(e,y),j=(0,a.A)(),h=(0,o.useMemo)((function(){return t.fee?.estimatedFeeFiatValue?(0,S.jsxs)(s.XStack,{gap:"$1",alignItems:"center",children:[(0,S.jsx)(s.Tooltip,{renderTrigger:(0,S.jsx)(s.Icon,{name:"GasOutline",size:"$4",color:"$iconSubdued"}),renderContent:(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$text",children:j.formatMessage({id:u.ETranslations.provider_network_fee})}),placement:"bottom-start"}),(0,S.jsx)(s.NumberSizeableText,{size:"$bodyMd",color:"$textSubdued",formatter:"value",formatterOptions:{currency:r},children:t.fee.estimatedFeeFiatValue})]}):null}),[r,j,t.fee?.estimatedFeeFiatValue]),$=(0,o.useMemo)((function(){if(t.estimatedTime){var e,r=new i.A(t.estimatedTime),o=new i.A(60);if(r.isLessThan(o))e="< 1min";else e=`${r.dividedBy(60).integerValue(i.A.ROUND_UP).toNumber()}min`;return(0,S.jsxs)(s.XStack,{gap:"$1",alignItems:"center",children:[(0,S.jsx)(s.Tooltip,{renderTrigger:(0,S.jsx)(s.Icon,{name:"ClockTimeHistoryOutline",size:"$4",color:"$iconSubdued"}),renderContent:(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$text",children:j.formatMessage({id:u.ETranslations.provider_swap_duration})}),placement:"bottom-start"}),(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",children:e})]})}return null}),[j,t.estimatedTime]),_=(0,o.useMemo)((function(){var e;return(0,S.jsxs)(s.XStack,{gap:"$1",alignItems:"center",children:[(0,S.jsx)(s.Tooltip,{renderTrigger:(0,S.jsx)(s.Icon,{name:"HandCoinsOutline",size:"$4",color:"$iconSubdued"}),renderContent:(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$text",children:j.formatMessage({id:u.ETranslations.provider_protocol_fee})}),placement:"bottom-start"}),(0,S.jsx)(s.NumberSizeableText,{size:"$bodyMd",color:"$textSubdued",formatter:"value",formatterOptions:{currency:r},children:null!=(e=t.fee?.protocolFees)?e:0})]})}),[r,j,t.fee?.protocolFees]),w=(0,o.useMemo)((function(){if(m)return t?.errorMessage||j.formatMessage({id:u.ETranslations.provider_route_unable_fetch_price});if(t.limit){var e=new i.A(null!=l?l:0);if(t.limit.min){var r,o=new i.A(t.limit.min);if(e.lt(o))return j.formatMessage({id:u.ETranslations.provider_min_amount_required},{amount:(0,x.jq)(t.limit.min,{formatter:"balance"}),token:null!=(r=n?.symbol)?r:"unknown"})}if(t.limit.max){var a,s=new i.A(t.limit.max);if(e.gt(s))return j.formatMessage({id:u.ETranslations.provider_max_amount_required},{amount:(0,x.jq)(t.limit.max,{formatter:"balance"}),token:null!=(a=n?.symbol)?a:"unknown"})}}var d;return t.toAmount?`${(0,x.jq)(t.toAmount,{formatter:"balance"})} ${null!=(d=c?.symbol)?d:"unknown"}`:""}),[m,n?.symbol,l,j,t?.errorMessage,t.limit,t.toAmount,c?.symbol]),[O,T]=(0,o.useState)(!1),k=(0,o.useMemo)((function(){var e;return null!=(e=t.routesData?.map((function(e){var t,r={images:[{logoImageUri:n?.logoURI}],label:e.part?`${e.part}%`:""},o={images:[{logoImageUri:c?.logoURI}],label:""};return[r,...null!=(t=e.subRoutes?.map((function(e){var t,r=null!=(t=e?.map((function(e){return{logoImageUri:e.logo}})))?t:[];r=r?.length>3?r.slice(0,3):r;var o="protocols";return 1===e.length&&(o=e[0].name),{images:r,label:o}})))?t:[],o]})))?e:[]}),[n?.logoURI,t.routesData,c?.logoURI]),A=(0,o.useMemo)((function(){var e=t.routesData;return t.protocolNoRouterInfo?(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$textSubdued",mt:"$3.5",children:t.protocolNoRouterInfo}):e?.[0]?.subRoutes?.[0]?.length?(0,S.jsx)(v,{routeContent:k}):(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$textSubdued",mt:"$3.5",children:j.formatMessage({id:u.ETranslations.provider_route_no_information})})}),[j,t.protocolNoRouterInfo,t.routesData,k]);return(0,S.jsxs)(s.Stack,SwapProviderListItem_objectSpread(SwapProviderListItem_objectSpread({role:"button",group:"card",borderRadius:"$4",my:"$2",overflow:"hidden",borderCurve:"continuous",opacity:m?.5:1,borderWidth:g.A.hairlineWidth,borderColor:d?"$borderActive":"$borderSubdued",userSelect:"none",focusVisibleStyle:{outlineWidth:2,outlineColor:"$focusRing",outlineStyle:"solid",outlineOffset:2}},p),{},{children:[(0,S.jsxs)(s.XStack,{px:"$3.5",py:"$3",bg:"$bgSubdued","$group-card-hover":{bg:"$bgHover"},alignItems:"center",children:[(0,S.jsx)(s.Stack,{children:(0,S.jsx)(SwapProviderIcon,{providerLogo:t.info.providerLogo,lock:!!t.allowanceResult})}),(0,S.jsxs)(s.Stack,{px:"$3",flex:1,children:[(0,S.jsx)(s.SizableText,{color:"$text",size:"$bodyLgMedium",children:w}),(0,S.jsx)(s.SizableText,{color:"$textSubdued",size:"$bodyMdMedium",pt:"$1",children:t.info.providerName})]}),t.isBest||t.receivedBest||t.minGasCost||t.isAntiMEV?(0,S.jsxs)(s.XStack,{flexWrap:"wrap",justifyContent:"flex-end",m:-3,flex:1,children:[t.isBest?(0,S.jsx)(s.Stack,{p:3,children:(0,S.jsx)(s.Badge,{badgeType:"success",children:j.formatMessage({id:u.ETranslations.provider_label_overall_best})})}):null,t.receivedBest?(0,S.jsx)(s.Stack,{p:3,children:(0,S.jsx)(s.Badge,{badgeType:"info",children:j.formatMessage({id:u.ETranslations.provider_label_max_received})})}):null,t.minGasCost?(0,S.jsx)(s.Stack,{p:3,children:(0,S.jsx)(s.Badge,{badgeType:"info",children:j.formatMessage({id:u.ETranslations.provider_label_min_fee})})}):null,t.isAntiMEV?(0,S.jsx)(s.Stack,{p:3,children:(0,S.jsx)(s.Badge,{badgeType:"info",children:j.formatMessage({id:u.ETranslations.provider_label_anti_mev})})}):null]}):null]}),t.toAmount?(0,S.jsxs)(s.Stack,{py:"$2",px:"$3.5",children:[(0,S.jsxs)(s.XStack,{gap:"$3.5",alignItems:"center",children:[h,$,_,(0,S.jsxs)(s.XStack,{role:"button",borderRadius:"$2",alignItems:"center",onPress:function(e){T(!O),e.stopPropagation()},ml:"auto",pr:"$1",my:"$-0.5",py:"$0.5",mr:"$-1",hitSlop:s.NATIVE_HIT_SLOP,hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},focusVisibleStyle:{outlineWidth:2,outlineColor:"$focusRing",outlineStyle:"solid"},children:[(0,S.jsx)(s.SizableText,{pl:"$2",size:"$bodySmMedium",color:"$textSubdued",children:j.formatMessage({id:u.ETranslations.provider_route})}),(0,S.jsx)(f.S,SwapProviderListItem_objectSpread(SwapProviderListItem_objectSpread({},O?{from:{rotate:"0deg"},animate:{rotate:"90deg"}}:{from:{rotate:"90deg"},animate:{rotate:"0deg"}}),{},{transition:{type:"timing",duration:150},children:(0,S.jsx)(s.Icon,{name:"ChevronRightSmallOutline",size:"$5",color:"$iconSubdued"})}))]})]}),(0,S.jsx)(s.HeightTransition,{children:O?A:null})]}):null]}))}));var _=r(309008),w=function(e){return e.AVAILABLE="Available",e.UNAVAILABLE="Unavailable",e}(w||{}),InformationItem=function({icon:e,content:t}){return(0,S.jsxs)(s.XStack,{alignItems:"flex-start",gap:"$2",children:[(0,S.jsx)(s.Icon,{flexShrink:0,color:"$iconSubdued",size:"$5",name:e}),(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",flex:1,children:t})]})},SwapProviderSelectModal=function(){var e=(0,l.A)(),t=(0,a.A)(),[n]=(0,c.pd)(),[p]=(0,c.VS)(),[b]=(0,c.NE)(),[f]=(0,c.Q8)(),[,g]=(0,c.wG)(),[x,j]=(0,c.tb)(),[h]=(0,d.useSettingsPersistAtom)(),[v]=(0,c.Zr)(),y=(0,o.useCallback)((function(e){j(e)}),[j]),_=(0,o.useMemo)((function(){return[{label:t.formatMessage({id:u.ETranslations.provider_recommend}),value:m.cw.RECOMMENDED},{label:t.formatMessage({id:u.ETranslations.provider_sort_item_gas}),value:m.cw.GAS_FEE},{label:t.formatMessage({id:u.ETranslations.provider_sort_item_swap_duration}),value:m.cw.SWAP_DURATION},{label:t.formatMessage({id:u.ETranslations.provider_sort_item_received}),value:m.cw.RECEIVED}]}),[t]),O=(0,o.useMemo)((function(){var e=n.filter((function(e){return e.toAmount&&!e.limit?.min&&!e.limit?.max})),r=n.filter((function(e){return!e.toAmount||e.limit?.min||e.limit?.max}));return[...e?.length>0?[{title:"Available",type:w.AVAILABLE,data:e}]:[],...r?.length>0?[{title:t.formatMessage({id:u.ETranslations.provider_unavailable}),type:w.UNAVAILABLE,data:r}]:[]]}),[t,n]),T=(0,o.useCallback)((function(t){g(t),e.pop()}),[e,g]),k=(0,o.useCallback)((function({item:e}){var t=!e.toAmount,r=new i.A(null!=p?p:0);if(e.limit){if(e.limit.min){var o=new i.A(e.limit.min);r.lt(o)&&(t=!1)}if(e.limit.max){var n=new i.A(e.limit.max);r.gt(n)&&(t=!1)}}return(0,S.jsx)($,{onPress:t?void 0:function(){T(e)},selected:Boolean(e.info.provider===v?.info.provider&&e.info.providerName===v?.info.providerName),fromTokenAmount:p,fromToken:b,toToken:f,providerResult:e,currencySymbol:h.currencyInfo.symbol,disabled:t})}),[v?.info.provider,v?.info.providerName,b,p,T,h.currencyInfo.symbol,f]),A=(0,o.useMemo)((function(){return[{maxFee:.875,name:"metamask",fee:.875,color:"#F5841F",icon:"https://uni.onekey-asset.com/static/logo/metamasklogo.png"},{maxFee:.875,name:"zerion",fee:.8,color:"#2461ED",icon:"https://uni.onekey-asset.com/static/logo/zerionlogo.png"},{maxFee:.875,name:"oneKey",fee:.3,color:"$bgInverse",icon:r(702658)}]}),[]),I=(0,o.useCallback)((function(e){return(0,S.jsxs)(s.XStack,{gap:"$3",alignItems:"center",children:[(0,S.jsx)(s.Stack,{w:20,h:20,children:(0,S.jsx)(s.Image,{source:{uri:e.icon},w:16,h:16})}),(0,S.jsx)(s.Stack,{flex:1,children:(0,S.jsx)(s.Stack,{backgroundColor:e.color,borderRadius:"$full",width:e.fee/e.maxFee*100+"%",height:"$1"})}),(0,S.jsxs)(s.SizableText,{size:"$bodySm",color:"$text",textAlign:"right",children:[e.fee,"%"]})]})}),[]),M=(0,o.useCallback)((function(){return(0,S.jsx)(s.Popover,{title:t.formatMessage({id:u.ETranslations.provider_ios_popover_title}),renderTrigger:(0,S.jsx)(s.IconButton,{variant:"tertiary",size:"medium",icon:"InfoCircleOutline"}),renderContent:(0,S.jsxs)(s.Stack,{p:"$5",gap:"$6",children:[(0,S.jsxs)(s.Stack,{gap:"$3",children:[(0,S.jsxs)(s.Stack,{gap:"$1",children:[(0,S.jsx)(s.SizableText,{size:"$headingMd",color:"$text",children:t.formatMessage({id:u.ETranslations.provider_ios_popover_order_info_title})}),(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$textSubdued",children:t.formatMessage({id:u.ETranslations.provider_popover_order_info_content})})]}),(0,S.jsx)(InformationItem,{icon:"LockOutline",content:t.formatMessage({id:u.ETranslations.provider_ios_popover_approval_require_msg})}),(0,S.jsx)(InformationItem,{icon:"GasOutline",content:t.formatMessage({id:u.ETranslations.provider_network_fee})}),(0,S.jsx)(InformationItem,{icon:"ClockTimeHistoryOutline",content:t.formatMessage({id:u.ETranslations.provider_swap_duration})}),(0,S.jsx)(InformationItem,{icon:"HandCoinsOutline",content:t.formatMessage({id:u.ETranslations.provider_protocol_fee})})]}),(0,S.jsxs)(s.Stack,{gap:"$3",children:[(0,S.jsxs)(s.Stack,{gap:"$1",children:[(0,S.jsx)(s.SizableText,{size:"$headingMd",color:"$text",children:t.formatMessage({id:u.ETranslations.provider_ios_popover_onekey_fee})}),(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$textSubdued",children:t.formatMessage({id:u.ETranslations.provider_ios_popover_onekey_fee_content})})]}),(0,S.jsxs)(s.Stack,{gap:"$2",children:[(0,S.jsxs)(s.XStack,{gap:"$3",children:[(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$textSubdued",flex:100,children:t.formatMessage({id:u.ETranslations.provider_popover_wallet})}),(0,S.jsx)(s.SizableText,{size:"$bodySm",color:"$textSubdued",textAlign:"right",children:t.formatMessage({id:u.ETranslations.provider_popover_fee_rate})})]}),A.map((function(e){return I(e)}))]})]})]})})}),[t,A,I]);return(0,S.jsxs)(s.Page,{children:[(0,S.jsx)(s.Page.Header,{headerRight:M}),(0,S.jsx)(s.SectionList,{px:"$5",pt:"$2",pb:"$4",estimatedItemSize:"$10",renderItem:k,sections:O,renderSectionHeader:function({section:{type:e,title:r}}){return e===w.AVAILABLE?(0,S.jsx)(s.Select,{title:t.formatMessage({id:u.ETranslations.provider_sort_title}),items:_,onChange:y,value:x,renderTrigger:function({value:e,label:t,placeholder:r}){return(0,S.jsx)(s.Button,{mt:"$1",alignSelf:"flex-start",variant:"tertiary",icon:"FilterSortSolid",iconAfter:"ChevronDownSmallOutline",children:(0,S.jsx)(s.SizableText,{size:"$bodyMd",children:e?t:r})})}}):(0,S.jsx)(s.SectionList.SectionHeader,{title:r,px:"$0"})}})]})};const modal_SwapProviderSelectModal=function(){var e=(0,n.lq)(),{storeName:t}=e.params;return(0,S.jsx)(_.o,{storeName:t,children:(0,S.jsx)(SwapProviderSelectModal,{})})}},702658:(e,t,r)=>{e.exports=r.p+"static/media/logo.781fb4ab8cf90d7b625a.png"}}]);