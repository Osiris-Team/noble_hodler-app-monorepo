"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[17539],{326745:(e,n,t)=>{t.d(n,{u:()=>useAppRoute});var a=t(654266);function useAppRoute(){return(0,a.lq)()}},713989:(e,n,t)=>{t.d(n,{G:()=>StakeShouldUnderstand,a:()=>WithdrawShouldUnderstand});var a=t(908867),r=t(490343),i=t(254491),o=t(905817),s=t(831085),ShouldUnderstandListItemListItem=function({title:e,description:n,index:t}){return(0,s.jsxs)(r.YStack,{children:[(0,s.jsxs)(r.XStack,{children:[(0,s.jsx)(r.Stack,{w:"$5",children:(0,s.jsxs)(r.SizableText,{children:[t,"."]})}),(0,s.jsx)(r.Stack,{flex:1,children:(0,s.jsx)(r.SizableText,{children:e})})]}),n?(0,s.jsx)(r.XStack,{pl:"$5",children:(0,s.jsx)(r.SizableText,{children:n})}):null]})},ShouldUnderstand=function({title:e,logoURI:n,subtitle:t,items:a}){return(0,s.jsx)(r.YStack,{flex:1,children:(0,s.jsx)(r.ScrollView,{maxHeight:560,children:(0,s.jsx)(r.YStack,{pb:"$5",children:(0,s.jsxs)(r.Stack,{children:[(0,s.jsx)(r.Image,{w:"$14",h:"$14",src:n}),(0,s.jsxs)(r.YStack,{mt:"$5",children:[(0,s.jsx)(r.SizableText,{size:"$headingXl",children:e}),t?(0,s.jsx)(r.XStack,{mt:"$5",children:(0,s.jsx)(r.SizableText,{size:"$bodyLg",children:t})}):null]}),(0,s.jsx)(r.YStack,{mt:"$5",gap:"$5",children:a.map((function(e,n){return(0,s.jsx)(ShouldUnderstandListItemListItem,{index:n+1,title:e.title,description:e.description},n)}))})]})})})})},createTypography=function(e,n){return n?e:""},StakeShouldUnderstand=function({provider:e,logoURI:n,symbol:t,apr:l,updateFrequency:c,receiveSymbol:d,unstakingPeriod:u}){var m=(0,a.A)(),g=[];return g="everstake"===e&&["sol","eth","apt"].includes(t)?[createTypography(m.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsxs)(r.SizableText,{color:"$textSuccess",children:[l,"%"]})}),l),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_updated_around_time},{time:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:c})}),c),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_automatically_restaked},{automatically:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:m.formatMessage({id:i.ETranslations.earn_automatically})})}),!0),createTypography(m.formatMessage({id:i.ETranslations.earn_withdrawal_up_to_number_days},{number:u}),u)]:"everstake"===e&&["atom","matic"].includes(t)?[createTypography(m.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsxs)(r.SizableText,{color:"$textSuccess",children:[l,"%"]})}),{number:l}),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_updated_around_time},{time:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:c})}),c),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_manually_restaked},{manually:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:m.formatMessage({id:i.ETranslations.earn_manually})})}),!0),createTypography(m.formatMessage({id:i.ETranslations.earn_withdrawal_up_to_number_days},{number:u}),u)]:"lido"===e&&["eth","matic"].includes(t)?[createTypography(m.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsxs)(r.SizableText,{color:"$textSuccess",children:[l,"%"]})}),l),createTypography(m.formatMessage({id:i.ETranslations.earn_receive_token_trade_anytime},{token:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:d})}),d),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_updated_around_time},{time:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:c})}),c),createTypography(m.formatMessage({id:i.ETranslations.earn_rewards_automatically_restaked},{automatically:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:m.formatMessage({id:i.ETranslations.earn_automatically})})}),!0),createTypography(m.formatMessage({id:i.ETranslations.earn_withdrawal_up_to_number_days},{number:u}),u)]:"babylon"===e?[m.formatMessage({id:i.ETranslations.earn_stake_through_onekey_earn_points}),m.formatMessage({id:i.ETranslations.earn_check_staking_results_overflow}),createTypography(m.formatMessage({id:i.ETranslations.earn_early_withdraw_stake_unstaking_period},{number:u}),u)]:[createTypography(m.formatMessage({id:i.ETranslations.earn_earn_up_to_number_per_year},{number:(0,s.jsx)(r.SizableText,{color:"$textSuccess",children:null!=l?l:4})}),!0)],(0,s.jsx)(ShouldUnderstand,{logoURI:n,title:m.formatMessage({id:i.ETranslations.earn_provider_asset_staking},{provider:(0,o.c)(e),asset:t.toUpperCase()}),items:g.filter((function(e){return!!e})).map((function(e){return{title:e}}))})},WithdrawShouldUnderstand=function({provider:e,symbol:n,logoURI:t,withdrawalPeriod:r}){var l=(0,a.A)();return(0,s.jsx)(ShouldUnderstand,{logoURI:t,title:l.formatMessage({id:i.ETranslations.earn_provider_asset_withdrawal},{provider:(0,o.c)(e),asset:n.toUpperCase()}),items:[{title:l.formatMessage({id:i.ETranslations.earn_withdrawal_take_up_to_number_days},{number:r})},{title:l.formatMessage({id:i.ETranslations.earn_claim_assets_after_processing})}]})}},90393:(e,n,t)=>{t.d(n,{Z:()=>useProviderLabel});var a=t(908867),r=t(254491),useProviderLabel=function(e){var n=(0,a.A)(),t=n.formatMessage({id:r.ETranslations.global_protocol});return"everstake"===e.toLowerCase()?t=n.formatMessage({id:r.ETranslations.earn_validator}):"babylogn"===e.toLowerCase()&&(t=n.formatMessage({id:r.ETranslations.earn_finality_provider})),t}},653913:(e,n,t)=>{t.d(n,{B8:()=>useUniversalStake,D0:()=>useUniversalClaim,Pg:()=>useUniversalWithdraw});var a=t(586330),r=t(514041),i=t(610421),o=t(927799),s=t(897976),l=t(184251),c=t(714191),d=t(161024);function useUniversalStake({networkId:e,accountId:n}){var t,{navigationToSendConfirm:c}=(0,o.E)({accountId:n,networkId:e});return(0,r.useCallback)((t=(0,a.A)((function*({amount:t,symbol:a,term:r,provider:o,stakingInfo:d,onSuccess:u,onFail:m}){var g,b,p=yield i.A.serviceStaking.buildStakeTransaction({amount:t,networkId:e,accountId:n,symbol:a,term:r,provider:o}),f=yield s.rq.getVault({networkId:e,accountId:n}),k=yield f.buildStakeEncodedTx(p);l.A.isBTCNetwork(e)&&(g=!0,b=!1),yield c({encodedTx:k,stakingInfo:d,onSuccess:u,onFail:m,useFeeInTx:g,feeInfoEditable:b})})),function(e){return t.apply(this,arguments)}),[c,n,e])}function useUniversalWithdraw({networkId:e,accountId:n}){var t,{navigationToSendConfirm:l}=(0,o.E)({accountId:n,networkId:e});return(0,r.useCallback)((t=(0,a.A)((function*({amount:t,symbol:r,provider:o,identity:u,stakingInfo:m,onSuccess:g,onFail:b}){var p,f=yield i.A.serviceStaking.getStakingConfigs({networkId:e,symbol:r,provider:o});if(!f)throw new Error("Staking config not found");if(f?.unstakeWithSignMessage){var k=yield i.A.serviceAccount.getAccount({accountId:n,networkId:e}),{message:_,deadline:x}=yield i.A.serviceStaking.buildLidoEthPermitMessageData({accountId:n,networkId:e,amount:t}),y=yield i.A.serviceDApp.openSignMessageModal({accountId:n,networkId:e,request:{origin:"https://lido.fi/",scope:"ethereum"},unsignedMessage:{type:d.$.TYPED_DATA_V4,message:_,payload:[k.address,_]},sceneName:c.Zs.home});p=yield i.A.serviceStaking.buildUnstakeTransaction({amount:t,networkId:e,accountId:n,symbol:r,provider:o,signature:y,deadline:x})}else p=yield i.A.serviceStaking.buildUnstakeTransaction({amount:t,identity:u,networkId:e,accountId:n,symbol:r,provider:o});var h,S=yield s.rq.getVault({networkId:e,accountId:n}),w=yield S.buildStakeEncodedTx(p);yield l({encodedTx:w,stakingInfo:m,signOnly:f?.withdrawSignOnly,onSuccess:(h=(0,a.A)((function*(t){if(f?.withdrawSignOnly){var a=t[0].signedTx.finalizedPsbtHex;a&&u&&(yield i.A.serviceStaking.unstakePush({txId:u,networkId:e,accountId:n,symbol:r,provider:o,unstakeTxHex:a}),g?.(t))}else g?.(t)})),function onSuccess(e){return h.apply(this,arguments)}),onFail:b})})),function(e){return t.apply(this,arguments)}),[n,e,l])}function useUniversalClaim({networkId:e,accountId:n}){var t,{navigationToSendConfirm:l}=(0,o.E)({accountId:n,networkId:e});return(0,r.useCallback)((t=(0,a.A)((function*({identity:t,amount:a,provider:r,symbol:o,stakingInfo:c,onSuccess:d,onFail:u}){var m=yield i.A.serviceStaking.buildClaimTransaction({networkId:e,accountId:n,symbol:o,provider:r,amount:a,identity:t}),g=yield s.rq.getVault({networkId:e,accountId:n}),b=yield g.buildStakeEncodedTx(m);yield l({encodedTx:b,stakingInfo:c,onSuccess:d,onFail:u})})),function(e){return t.apply(this,arguments)}),[l,n,e])}},717539:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Withdraw});var a=t(586330),r=t(514041),i=t(241440),o=t(908867),s=t(490343),l=t(498356),c=t(326745),d=t(254491),u=t(157572),m=t(550082),g=t(324586),b=t(88803),p=t(791088),f=t(259227),k=t(905817),_=t(713989),x=t(831085);function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function _objectSpread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(t),!0).forEach((function(n){(0,g.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var y={color:"$textSubdued",size:"$bodyLg"},UniversalWithdraw=function({balance:e,price:n,tokenImageUri:t,tokenSymbol:l,providerLogo:c,providerName:u,initialAmount:m,minAmount:g="0",withdrawMinAmount:h,unstakingPeriod:S,providerLabel:w,decimals:v,showPayWith:T,payWithToken:j,payWithTokenRate:I="1",onConfirm:M}){var E=Number(n)>0?n:"0",[A,$]=(0,r.useState)(!1),[C,P]=(0,r.useState)(null!=m?m:""),[{currencyInfo:{symbol:z}}]=(0,f.useSettingsPersistAtom)(),O=(0,o.A)(),U=(0,r.useCallback)((0,a.A)((function*(){var e;s.Dialog.show({renderContent:(0,x.jsx)(_.a,{provider:null!=u?u:"",logoURI:null!=t?t:"",symbol:null!=l?l:"",withdrawalPeriod:null!=S?S:3}),onConfirm:(e=(0,a.A)((function*(e){try{$(!0),yield e.close(),yield M?.(C)}finally{$(!1)}})),function onConfirm(n){return e.apply(this,arguments)}),onConfirmText:O.formatMessage({id:d.ETranslations.global_withdraw}),showCancelButton:!1})})),[C,M,O,t,l,u,S]),N=(0,r.useCallback)((function(e){if(new i.A(e).isNaN())""===e&&P("");else{var n=Boolean(v&&Number(v)>0&&(0,k.FZ)(e)>v);P(n?function(e){return e}:e)}}),[v]),L=(0,r.useMemo)((function(){if(Number(C)>0&&Number(E)>0)return(0,i.A)(C).multipliedBy(E).toFixed()}),[C,E]),F=(0,r.useMemo)((function(){return new i.A(C).gt(e)}),[C,e]),R=(0,r.useMemo)((function(){var e=Math.max(Number(null!=h?h:0),Number(null!=g?g:0)),n=new i.A(e),t=new i.A(C);return n.gt(0)&&t.gt(0)?{result:t.isLessThan(n),value:n.toFixed()}:{result:!1,value:n.toFixed()}}),[g,C,h]),D=(0,r.useMemo)((function(){if(Number(h)>0){var n=new i.A(Number(h)),t=new i.A(C),a=new i.A(e);if(n.gt(0)&&t.gt(0)&&a.gte(0))return t.gt(0)&&a.minus(t).lt(n)}return!1}),[h,C,e]),W=(0,r.useCallback)((function(){N(e)}),[N,e]),B=(0,r.useMemo)((function(){return(0,i.A)(C).isNaN()||(0,i.A)(C).isLessThanOrEqualTo(0)||F||R.result}),[C,F,R.result]),Y=void 0===m;return(0,x.jsxs)(s.YStack,{children:[(0,x.jsxs)(s.Stack,{mx:"$2",px:"$3",gap:"$5",children:[(0,x.jsxs)(s.Stack,{position:"relative",opacity:Y?1:.7,children:[(0,x.jsx)(b.J,{bg:Y?"$bgApp":"$bgDisabled",hasError:F||R.result,value:C,onChange:N,tokenSelectorTriggerProps:{selectedTokenImageUri:t,selectedTokenSymbol:l},inputProps:{placeholder:"0"},balanceProps:{value:e,onPress:W},valueProps:{value:L,currency:L?z:void 0},enableMaxAmount:!0}),Y?null:(0,x.jsx)(s.Stack,{position:"absolute",w:"100%",h:"100%"})]}),(0,x.jsxs)(s.YStack,{gap:"$1",children:[D?(0,x.jsx)(s.Alert,{icon:"InfoCircleOutline",type:"warning",title:O.formatMessage({id:d.ETranslations.earn_unstake_all_due_to_min_withdrawal},{number:h,symbol:l})}):null,R.result?(0,x.jsx)(s.Alert,{icon:"InfoCircleOutline",type:"critical",title:O.formatMessage({id:d.ETranslations.earn_minimum_amount},{number:`${R.value} ${null!=l?l:""}`})}):null,F?(0,x.jsx)(s.Alert,{icon:"InfoCircleOutline",type:"critical",title:O.formatMessage({id:d.ETranslations.earn_insufficient_staked_balance})}):null]})]}),(0,x.jsxs)(s.YStack,{children:[C?(0,x.jsx)(p.c,{title:O.formatMessage({id:d.ETranslations.earn_receive}),titleProps:y,children:(0,x.jsx)(s.SizableText,{children:(0,x.jsx)(s.NumberSizeableText,{formatter:"balance",size:"$bodyLgMedium",formatterOptions:{tokenSymbol:l},children:C})})}):null,T&&j&&Number(C)>0?(0,x.jsx)(p.c,{title:O.formatMessage({id:d.ETranslations.earn_pay_with}),titleProps:y,children:(0,x.jsx)(s.SizableText,{children:(0,x.jsx)(s.NumberSizeableText,{formatter:"balance",size:"$bodyLgMedium",formatterOptions:{tokenSymbol:j},children:(0,i.A)(C).multipliedBy(I).toFixed()})})}):null,c&&u?(0,x.jsx)(p.c,{title:null!=w?w:O.formatMessage({id:d.ETranslations.global_protocol}),titleProps:y,children:(0,x.jsxs)(s.XStack,{gap:"$2",alignItems:"center",children:[(0,x.jsx)(s.Image,{width:"$5",height:"$5",src:c,borderRadius:"$2"}),(0,x.jsx)(s.SizableText,{size:"$bodyLgMedium",children:(0,k.c)(u)})]})}):null,S?(0,x.jsxs)(p.c,{children:[(0,x.jsxs)(s.XStack,{flex:1,alignItems:"center",gap:"$1",children:[(0,x.jsx)(s.SizableText,_objectSpread(_objectSpread({},y),{},{children:O.formatMessage({id:d.ETranslations.earn_unstaking_period})})),(0,x.jsx)(s.Popover,{title:O.formatMessage({id:d.ETranslations.earn_unstaking_period}),renderTrigger:(0,x.jsx)(s.IconButton,{iconColor:"$iconSubdued",size:"small",icon:"InfoCircleOutline",variant:"tertiary"}),renderContent:(0,x.jsx)(s.Stack,{p:"$5",children:(0,x.jsx)(s.SizableText,{children:O.formatMessage({id:d.ETranslations.earn_unstaking_period_tooltip})})})})]}),(0,x.jsx)(s.XStack,{gap:"$2",alignItems:"center",children:(0,x.jsx)(s.SizableText,{size:"$bodyLgMedium",children:O.formatMessage({id:d.ETranslations.earn_up_to_number_days},{number:S})})})]}):null]}),(0,x.jsx)(s.Page.Footer,{onConfirmText:O.formatMessage({id:d.ETranslations.global_continue}),confirmButtonProps:{onPress:U,loading:A,disabled:B}})]})},h=t(90393),S=t(653913);const Withdraw=function(){var e,n=(0,o.A)(),t=(0,c.u)(),{accountId:g,networkId:b,details:p,identity:f,amount:_,onSuccess:y}=t.params,{token:w,provider:v,active:T}=p,{price:j,info:I}=w,M=(0,k.Y)(p),E=(0,l.A)(),A=(0,S.Pg)({accountId:g,networkId:b}),$=(0,r.useCallback)((e=(0,a.A)((function*(e){yield A({amount:e,identity:f,symbol:I.symbol,provider:v.name,stakingInfo:{label:m.D.Withdraw,protocol:v.name,send:{token:I,amount:e},tags:[M]},onSuccess:function(){E.pop(),u.U.staking.page.unstaking({token:I,stakingProtocol:v.name}),y?.()}})})),function(n){return e.apply(this,arguments)}),[A,I,E,v,M,f,y]),C=(0,h.Z)(v.name),P=(0,r.useMemo)((function(){return"lido"===v.name.toLowerCase()}),[v]);return(0,x.jsxs)(s.Page,{children:[(0,x.jsx)(s.Page.Header,{title:n.formatMessage({id:d.ETranslations.earn_withdraw_token},{token:I.symbol})}),(0,x.jsx)(s.Page.Body,{children:(0,x.jsx)(UniversalWithdraw,{price:j,decimals:p.token.info.decimals,balance:(0,i.A)(null!=T?T:0).toFixed(),initialAmount:_,tokenSymbol:I.symbol,tokenImageUri:I.logoURI,providerLogo:v.logoURI,providerName:v.name,onConfirm:$,withdrawMinAmount:p.minUnstakeAmount,unstakingPeriod:p.unstakingPeriod,providerLabel:C,showPayWith:P,payWithToken:p.rewardToken,payWithTokenRate:v.lidoStTokenRate})})]})}},905817:(e,n,t)=>{t.d(n,{FZ:()=>countDecimalPlaces,Y:()=>buildLocalTxStatusSyncId,c:()=>capitalizeString});var buildLocalTxStatusSyncId=function(e){return`${e.provider.name.toLowerCase()}-${e.token.info.symbol.toLowerCase()}`};function capitalizeString(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e}function countDecimalPlaces(e){var n="string"==typeof e?Number(e):e;if(Number.isNaN(n))return 0;var t=n.toString(),a=t.indexOf(".");return-1===a?0:t.length-a-1}},550082:(e,n,t)=>{t.d(n,{D:()=>a});var a=function(e){return e.Stake="Stake",e.Claim="Claim",e.Redeem="Redeem",e.Withdraw="Withdraw",e.Unknown="Unknown",e}({});!function(e){e.EthEvertStake="eth-evert-stake",e.EthLido="eth-lido",e.BtcBabylon="btc-babylon"}({})}}]);