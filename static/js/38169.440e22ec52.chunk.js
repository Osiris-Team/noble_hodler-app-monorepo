"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[38169],{583354:(e,t,n)=>{n.d(t,{D:()=>o,U:()=>r});var r=function(e){return e.hd="hd",e.qr="qr",e.hardware="hardware",e.imported="imported",e.watching="watching",e.external="external",e}({}),o=function(e){return e.DEPOSIT="deposit",e.WITHDRAW="withdraw",e}({})},82506:(e,t,n)=>{n.d(t,{d:()=>useDebounce});var r=n(578104);function useDebounce(e,t,n){var[o]=(0,r.d7)(e,t,n);return o}},20322:(e,t,n)=>{n.d(t,{j:()=>useSwapFromAccountNetworkSync,z:()=>useSwapAddressInfo});var r=n(324586),o=n(586330),a=n(712784),s=n.n(a),i=n(514041),c=n(490343),u=n(153763),d=n(259227),l=n(392097),p=n(619390),f=n(317522),m=n(162616),w=n(325529);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function useSwapFromAccountNetworkSync(){var{updateSelectedAccountNetwork:e}=(0,m.z$)().current,[t]=(0,w.NE)(),{activeAccount:n}=(0,m.LH)({num:1}),[r,a]=(0,w.rv)(),[p]=(0,w.dF)(),[,g]=(0,d.useSettingsAtom)(),[b]=(0,w.Q8)(),S=(0,i.useRef)(),k=(0,i.useRef)(),v=(0,i.useRef)(),A=(0,i.useRef)(r),I=(0,i.useRef)(n);I.current!==n&&(I.current=n),S.current!==t&&(S.current=t),k.current!==b&&(k.current=b),A.current!==r&&(A.current=r),v.current!==p&&(v.current=p);var y,T=(0,i.useCallback)(s()((0,o.A)((function*(){S.current&&(yield e({num:0,networkId:S.current?.networkId})),k.current&&(yield e({num:1,networkId:k.current?.networkId})),S.current&&k.current&&(A.current?.networkId&&k.current?.networkId!==A.current?.networkId||!A.current?.networkId&&!I.current?.account&&I.current?.wallet||!1===v.current)&&(g((function(e){return _objectSpread(_objectSpread({},e),{},{swapToAnotherAccountSwitchOn:!1})})),a((function(e){return _objectSpread(_objectSpread({},e),{},{address:void 0})})),setTimeout((function(){k.current&&e({num:1,networkId:k.current?.networkId})}),500))})),100),[g,e]),j=(0,c.usePageType)();(0,f.A)(l.V4.Swap,(y=(0,o.A)((function*(e,t){if(j!==c.EPageType.modal){if(t)return;e&&(yield T())}})),function(e,t){return y.apply(this,arguments)})),(0,i.useEffect)((function(){j!==c.EPageType.modal&&(0,o.A)((function*(){yield T()}))()}),[T,t,b,p,j]);var h=(0,u.E)();(0,i.useEffect)((function(){j===c.EPageType.modal&&h&&(0,o.A)((function*(){yield T()}))()}),[T,h,j,t,b,p])}function useSwapAddressInfo(e){var{activeAccount:t}=(0,m.LH)({num:e===p.En.FROM?0:1}),[{swapToAnotherAccountSwitchOn:n}]=(0,d.useSettingsAtom)(),[r]=(0,w.rv)();return(0,i.useMemo)((function(){var o={networkId:void 0,address:void 0,accountInfo:void 0};return e===p.En.TO&&n&&r.address&&r.networkId&&t&&t.network?.id===r.networkId?_objectSpread(_objectSpread({},o),{},{address:r.address,networkId:r.networkId,accountInfo:r.accountInfo}):t?_objectSpread(_objectSpread({},o),{},{address:t.account?.address,networkId:t.network?.id,accountInfo:_objectSpread({},t)}):o}),[e,n,r,t])}},866063:(e,t,n)=>{n.d(t,{FI:()=>useSwapInit,GM:()=>useSwapTokenList,ZF:()=>useSwapSelectedTokenInfo});var r=n(503668),o=n.n(r),a=n(324586),s=n(586330),i=n(514041),c=n(241440),u=n(490343),d=n(153763),l=n(259227),p=n(625931),f=n(22937),m=n(392097),w=n(184251),g=n(734818),b=n(58546),S=n(619390),k=n(610421),v=n(317522),A=n(162616),I=n(325529),y=n(20322);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function useSwapInit(e){var[t,n]=(0,I.ZM)(),[r,a]=(0,I.NE)(),[c,d]=(0,I.Q8)(),[,f]=(0,l.useInAppNotificationAtom)(),{syncNetworksSort:g}=(0,I.eR)().current,T=(0,y.z)(S.En.FROM),{updateSelectedAccountNetwork:j}=(0,A.z$)().current,[h,x]=(0,i.useState)(!0),[_,O]=(0,i.useState)(!1),E=(0,i.useRef)();E.current!==T&&(E.current=T);var M=(0,i.useRef)([]);M.current!==t&&(M.current=t);var $=(0,i.useRef)();$.current!==r&&($.current=r);var C=(0,i.useRef)();C.current!==c&&(C.current=c);var R=(0,i.useCallback)((0,s.A)((function*(){if(t.length)x(!1);else{var e=yield k.A.simpleDb.swapNetworksSort.getRawData();e?.data?.length&&(n(e.data),x(!1));var r=[],o=yield k.A.serviceSwap.fetchSwapNetworks();if(r=[...o],e?.data?.length&&o?.length){var a=e.data;r=a.filter((function(e){return o.find((function(t){return t.networkId===e.networkId}))})).map((function(e){var t=o.find((function(t){return t.networkId===e.networkId}));return _objectSpread(_objectSpread({},e),t)})).concat(o.filter((function(e){return!a.find((function(t){return t.networkId===e.networkId}))})))}r.length&&(yield k.A.simpleDb.swapNetworksSort.setRawData({data:r}),e?.data?.length&&e?.data?.length===r.length||(n(r),x(!1)))}})),[n,t.length]),P=(0,i.useCallback)((0,s.A)((function*(){if(!$.current&&!C.current){var t,n;if(e?.importFromToken&&M.current.find((function(t){return t.networkId===e?.importFromToken?.networkId}))||e?.importToToken&&M.current.find((function(t){return t.networkId===e?.importFromToken?.networkId})))return a(e.importFromToken),d(e.importToToken),void g(null!=(t=null!=(n=e.importFromToken?.networkId)?n:e.importToToken?.networkId)?t:(0,p.V)().onekeyall);if(E.current?.accountInfo?.ready&&E.current?.networkId&&M.current.length&&(!e?.importNetworkId||!E.current?.networkId||e?.importNetworkId===E.current?.networkId)&&!_){var r=M.current.find((function(e){return e.networkId===E.current?.networkId})),s=w.A.isAllNetwork({networkId:E.current?.networkId}),i=r,c=r?.networkId;if(s&&(c=(0,p.V)().onekeyall,i=M.current.find((function(e){return"evm--1"===e.networkId}))),i&&c&&(!o()(b.TW[c]?.fromToken)||!o()(b.TW[c]?.toToken))){var u=b.TW[c]?.fromToken,l=b.TW[c]?.toToken;u&&(a(_objectSpread(_objectSpread({},u),{},{networkLogoURI:i?.logoURI})),g(u.networkId)),l&&(d(_objectSpread(_objectSpread({},l),{},{networkLogoURI:i?.logoURI})),g(l.networkId))}}}})),[e?.importFromToken,e?.importNetworkId,e?.importToToken,a,d,_,g]);(0,i.useEffect)((function(){(0,s.A)((function*(){var e=yield k.A.simpleDb.swapConfigs.getRecentTokenPairs();f((function(t){return _objectSpread(_objectSpread({},t),{},{swapRecentTokenPairs:e})}))}))()}),[f]),(0,i.useEffect)((function(){(0,s.A)((function*(){yield R()}))()}),[R,t.length]),(0,i.useEffect)((function(){(0,s.A)((function*(){e?.importNetworkId&&E.current?.networkId&&e.importNetworkId!==E.current.networkId&&(yield j({num:0,networkId:e.importNetworkId}))}))()}),[e?.importNetworkId,j]),(0,i.useEffect)((function(){(0,s.A)((function*(){yield P()}))()}),[T.accountInfo?.ready,t.length,T.networkId,e?.importFromToken,e?.importToToken,e?.importNetworkId]);var N=(0,u.usePageType)();return(0,v.A)(m.V4.Swap,(function(e,t){N!==u.EPageType.modal&&e&&O(!!t)})),{fetchLoading:h}}function useSwapTokenList(e,t,n){var[r,o]=(0,i.useState)([]),[{tokenCatch:a}]=(0,I.PQ)(),[s]=(0,I.Yb)(),[u]=(0,I.ZM)(),{tokenListFetchAction:d,swapLoadAllNetworkTokenList:l}=(0,I.eR)().current,p=(0,y.z)(e),[m]=(0,I.Hb)(),b=(0,i.useMemo)((function(){return{networkId:t,keywords:n,accountAddress:p?.address,accountNetworkId:p?.networkId,accountId:p?.accountInfo?.account?.id}}),[t,n,p?.address,p?.networkId,p?.accountInfo?.account]),S=(0,i.useMemo)((function(){var e,t,n;return s[null!=(e=null!=(t=null!=(n=p?.accountInfo?.indexedAccount?.id)?n:p?.accountInfo?.account?.id)?t:p?.accountInfo?.dbAccount?.id)?e:"noAccountId"]}),[s,p?.accountInfo?.indexedAccount?.id,p?.accountInfo?.account?.id,p?.accountInfo?.dbAccount?.id]),k=(0,i.useCallback)((function(e){var t=e.filter((function(e){var t,n=new c.A(null!=(t=e.price)?t:"0");return!n.isNaN()&&!n.isZero()}))?.sort((function(e,t){var n,r,o=new c.A(null!=(n=e.fiatValue)?n:"0");return new c.A(null!=(r=t.fiatValue)?r:"0").comparedTo(o)})),n=e.filter((function(e){var t,n=new c.A(null!=(t=e.price)?t:"0");return n.isNaN()||n.isZero()}))?.sort((function(e,t){var n,r,o=new c.A(null!=(n=e.fiatValue)?n:"0");return new c.A(null!=(r=t.fiatValue)?r:"0").comparedTo(o)}));return[...t,...n]}),[]),v=(0,i.useCallback)((function({swapAllNetRecommend:e,swapSearchTokens:t}){var n,r;if(e?.length&&!S)return[];var o=null!=(n=S?.map((function(e){var t=u.find((function(t){return t.networkId===e.networkId}));return t?_objectSpread(_objectSpread({},e),{},{networkLogoURI:t.logoURI}):e}))?.filter((function(e){return u.find((function(t){return t.networkId===e.networkId}))})))?n:[],a=null!=(r=o?.filter((function(e){var t,n=new c.A(null!=(t=e?.balanceParsed)?t:"0");return!n.isNaN()&&!n.isZero()})))?r:[];if(e){var s,i=null!=(s=e?.filter((function(e){return!a?.find((function(t){return(0,g.BQ)({token1:{networkId:t?.networkId,contractAddress:t?.contractAddress},token2:{networkId:e?.networkId,contractAddress:e?.contractAddress}})}))})))?s:[],d=[...a,...i];return k(null!=d?d:[])}if(t){var l=t.map((function(e){if(u.find((function(t){return t.networkId===e.networkId}))){var t=a.find((function(t){return t?.contractAddress===e?.contractAddress&&t?.networkId===e?.networkId}));return t||e}})).filter((function(e){return e}));return k(null!=l?l:[])}return[]}),[k,S,u]),A=(0,f.bJ)(w.A.isAllNetwork({networkId:b.networkId})&&n?v({swapSearchTokens:a?.[JSON.stringify(b)]?.data||[]}):a?.[JSON.stringify(b)]?.data||[],{shouldSort:!1,keys:["symbol","contractAddress"]}),T=(0,i.useRef)(A);return T.current!==A&&(T.current=A),(0,i.useEffect)((function(){if(!b.accountNetworkId||b.networkId===b.accountNetworkId||w.A.isAllNetwork({networkId:b.networkId})){var e;if(b.networkId&&!n&&w.A.isAllNetwork({networkId:b.networkId}))l(b.networkId,p?.accountInfo?.indexedAccount?.id,p?.accountInfo?.indexedAccount?.id?void 0:null!=(e=p?.accountInfo?.account?.id)?e:p?.accountInfo?.dbAccount?.id);d(b)}}),[p?.accountInfo?.account?.id,p?.accountInfo?.dbAccount?.id,p?.accountInfo?.indexedAccount?.id,l,b,d,n]),(0,i.useEffect)((function(){b.accountNetworkId&&b.networkId!==b.accountNetworkId&&!w.A.isAllNetwork({networkId:b.networkId})||(n&&T.current?o(T.current.search(n)):o(w.A.isAllNetwork({networkId:b.networkId})?v({swapAllNetRecommend:a?.[JSON.stringify(b)]?.data||[]}):a?.[JSON.stringify(b)]?.data||[]))}),[a,b,t,n,v]),{fetchLoading:m&&0===r.length||w.A.isAllNetwork({networkId:b.networkId})&&!S,currentTokens:r}}function useSwapSelectedTokenInfo({token:e,type:t}){var n=(0,y.z)(t),[r,o]=(0,i.useState)(0),[{swapHistoryPendingList:a}]=(0,l.useInAppNotificationAtom)(),{loadSwapSelectTokenDetail:s}=(0,I.eR)().current,c=(0,i.useRef)(a);c.current!==a&&(c.current=a);var p=(0,i.useRef)(r);p.current!==r&&(p.current=r);var f=(0,i.useRef)(n);f.current!==n&&(f.current=n);var w=(0,d.E)(),g=(0,i.useRef)(w);g.current!==w&&(g.current=w),(0,i.useEffect)((function(){if(g.current&&a.length){var e=a.filter((function(e){return e.status===S.lr.SUCCESS})).length;e>p.current&&(s(t,f.current,!0),o(e))}}),[s,a,t]),(0,i.useEffect)((function(){s(t,f.current,!e?.reservationValue&&e?.isNative)}),[t,n,e?.networkId,e?.contractAddress,s,e?.reservationValue,e?.isNative]);var b=(0,u.usePageType)();(0,v.A)(m.V4.Swap,(function(e,n){if(b!==u.EPageType.modal&&e&&!n&&c.current.length){var r=c.current.filter((function(e){return e.status===S.lr.SUCCESS})).length;r>p.current&&(s(t,f.current,!0),o(r))}}))}},309008:(e,t,n)=>{n.d(t,{o:()=>d});var r=n(324586),o=n(514041),a=n(325529),s=n(2577),i=n(597102),c=n(829561),u=n(831085);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=(0,o.memo)((function(e){var{children:t,storeName:n}=e,r=(0,c.x6)(n),o=s.A.getOrCreateStore(r);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(i.H,_objectSpread({},r)),(0,u.jsx)(a.BY,{store:o,children:t})]})}));d.displayName="SwapProviderMirror"},622487:(e,t,n)=>{n.d(t,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var r=n(514041),o=n(490343),a=n(896666),s=n(498356),i=n(259227),c=n(392097),u=n(628380),d=n(619390),l=n(831085);const __WEBPACK_DEFAULT_EXPORT__=function(){var e=(0,s.A)(),[{swapHistoryPendingList:t}]=(0,i.useInAppNotificationAtom)(),n=(0,r.useMemo)((function(){return t.filter((function(e){return e.status===d.lr.PENDING||e.status===d.lr.CANCELING}))}),[t]),p=(0,r.useCallback)((function(){e.pushModal(c.ry.SwapModal,{screen:u.u.SwapHistoryList})}),[e]);return(0,l.jsx)(a.bE,{children:n.length>0?(0,l.jsxs)(o.Badge,{badgeSize:"lg",badgeType:"info",onPress:p,children:[(0,l.jsx)(o.Stack,{borderRadius:"$full",p:3,bg:"$borderInfo",children:(0,l.jsx)(o.Stack,{w:"$1.5",h:"$1.5",borderRadius:"$full",bg:"$iconInfo"})}),(0,l.jsx)(o.Badge.Text,{cursor:"pointer",pl:"$2",children:`${n.length} Pending `})]}):(0,l.jsx)(a.v$,{icon:"ClockTimeHistoryOutline",onPress:p,iconProps:{size:24},size:"medium"})})}},138169:(e,t,n)=>{n.d(t,{A:()=>SwapMainLand});var r=n(324586),o=n(586330),a=n(514041),s=n(490343),i=n(498356),c=n(325529),u=n(259227),d=n(392097),l=n(628380),p=n(58546),f=n(619390),m=n(241440),w=n(908867),g=n(17617),b=n(254491),S=n(831085);const k=(0,a.memo)((function({onSelectTokenPairs:e,tokenPairs:t,fromTokenAmount:n}){var r=(0,w.A)(),[o,i]=(0,a.useState)(!1),c=new m.A(null!=n?n:0),u=(0,a.useCallback)((function(){var n=!o&&t.length>=6?t.slice(0,5):t;return(0,S.jsx)(s.XStack,{pt:"$1",pb:"$3",gap:"$1.5",flexWrap:"wrap",children:(0,S.jsxs)(S.Fragment,{children:[n.map((function(t){return(0,S.jsx)(s.XStack,{role:"button",userSelect:"none",alignItems:"center",px:"$2",py:"$1",bg:"$bg",borderRadius:"$4",borderWidth:g.A.hairlineWidth,borderColor:"$borderSubdued",hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},focusable:!0,focusVisibleStyle:{outlineColor:"$focusRing",outlineStyle:"solid",outlineWidth:2,outlineOffset:2},onPress:function(){e(t)},children:(0,S.jsx)(s.SizableText,{size:"$bodyMdMedium",children:`${t.fromToken.symbol}/${t.toToken.symbol}`})},`${t.fromToken.contractAddress}-${t.toToken.contractAddress}`)})),t.length>=6?(0,S.jsx)(s.Stack,{role:"button",userSelect:"none",alignItems:"center",px:"$1.5",py:"$1",bg:"$bg",borderRadius:"$4",borderWidth:g.A.hairlineWidth,borderColor:"$borderSubdued",hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},focusable:!0,focusVisibleStyle:{outlineColor:"$focusRing",outlineStyle:"solid",outlineWidth:2,outlineOffset:2},onPress:function(){i(!o)},children:(0,S.jsx)(s.Stack,{animation:"quick",justifyContent:"center",alignItems:"center",rotate:o?"180deg":"0deg",children:(0,S.jsx)(s.Icon,{name:"ChevronDownSmallOutline",color:o?"$iconActive":"$iconSubdued",size:"$5"})})},"more-token-pairs"):null]})})}),[e,o,t]);return(c.isZero()||c.isNaN())&&t?.length?(0,S.jsxs)(s.YStack,{gap:"$1",children:[(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",children:r.formatMessage({id:b.ETranslations.swap_page_recent_trade})}),u()]}):null}));var v=n(20322),A=n(583354),I=n(157572),y=n(403144),T=n(610421),j=n(927799);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function useSwapBuildTx(){var e,t,n,r,s,i,[d]=(0,c.NE)(),[l]=(0,c.Q8)(),[{slippageItem:p}]=(0,c.H_)(),[w]=(0,c.Zr)(),[,g]=(0,c.mA)(),[,b]=(0,c.vS)(),[,S]=(0,c.sh)(),[k,h]=(0,u.useInAppNotificationAtom)(),[,x]=(0,c.VS)(),[,_]=(0,c.oz)(),O=(0,v.z)(f.En.FROM),E=(0,v.z)(f.En.TO),{generateSwapHistoryItem:M}=function useSwapTxHistoryActions(){var e,[t]=(0,c.ZM)(),[,n]=(0,c.NE)(),[,r]=(0,c.Q8)(),[,s]=(0,c.VS)(),[i]=(0,u.useSettingsPersistAtom)(),d=(0,a.useCallback)((e=(0,o.A)((function*({txId:e,gasFeeInNative:n,gasFeeFiatValue:r,swapTxInfo:o}){if(o){var a,s,c,u={status:f.lr.PENDING,currency:i.currencyInfo.symbol,baseInfo:{toAmount:o.receiver.amount,fromAmount:o.sender.amount,fromToken:o.sender.token,toToken:o.receiver.token,fromNetwork:t.find((function(e){return e?.networkId===o.sender.token.networkId})),toNetwork:t.find((function(e){return e?.networkId===o.receiver.token.networkId}))},txInfo:{txId:e,gasFeeFiatValue:r,gasFeeInNative:n,orderId:o.swapBuildResData.swftOrder?.orderId,sender:o.accountAddress,receiver:o.receivingAddress},date:{created:Date.now(),updated:Date.now()},swapInfo:{instantRate:null!=(a=o.swapBuildResData.result.instantRate)?a:"0",provider:o.swapBuildResData.result.info,socketBridgeScanUrl:o.swapBuildResData.socketBridgeScanUrl,oneKeyFee:null!=(s=o.swapBuildResData.result.fee?.percentageFee)?s:0,protocolFee:null!=(c=o.swapBuildResData.result.fee?.protocolFees)?c:0,orderId:o.swapBuildResData.orderId,supportUrl:o.swapBuildResData.result.supportUrl},ctx:o.swapBuildResData.ctx};yield T.A.serviceSwap.addSwapHistoryItem(u)}})),function(t){return e.apply(this,arguments)}),[i.currencyInfo.symbol,t]);return{generateSwapHistoryItem:d,swapAgainUseHistoryItem:(0,a.useCallback)((function(e){n(e?.baseInfo.fromToken),r(e?.baseInfo.toToken),s(e?.baseInfo.fromAmount)}),[n,s,r])}}(),[{isFirstTimeSwap:$},C]=(0,u.useSettingsPersistAtom)(),{navigationToSendConfirm:R}=(0,j.E)({accountId:null!=(e=O.accountInfo?.account?.id)?e:"",networkId:null!=(t=O.networkId)?t:""}),P=(0,a.useCallback)((n=(0,o.A)((function*({swapFromToken:e,swapToToken:t}){yield T.A.serviceSwap.swapRecentTokenPairsUpdate({fromToken:e,toToken:t})})),function(e){return n.apply(this,arguments)}),[]),N=(0,a.useCallback)((r=(0,o.A)((function*(e){if(e?.[0]){x(""),g([]),b(0);var t=e[0].signedTx,n=e[0].decodedTx,r=t.txid,{swapInfo:o}=t,{totalFeeInNative:a,totalFeeFiatValue:s,networkId:i}=n;o&&(yield M({txId:r,gasFeeFiatValue:s,gasFeeInNative:a,swapTxInfo:o}),o.sender.token.networkId===o.receiver.token.networkId&&T.A.serviceNotification.blockNotificationForTxId({networkId:i,tx:r}))}S(!1)})),function(e){return r.apply(this,arguments)}),[M,S,x,g,b]),z=(0,a.useCallback)((s=(0,o.A)((function*(e){if(e?.[0]){var t=e[0].signedTx.txid;k.swapApprovingTransaction&&!k.swapApprovingTransaction.resetApproveValue&&T.A.serviceNotification.blockNotificationForTxId({networkId:k.swapApprovingTransaction.fromToken.networkId,tx:t}),h((function(e){return e.swapApprovingTransaction?_objectSpread(_objectSpread({},e),{},{swapApprovingTransaction:_objectSpread(_objectSpread({},e.swapApprovingTransaction),{},{txId:t})}):e}))}})),function(e){return s.apply(this,arguments)}),[k.swapApprovingTransaction,h]),L=(0,a.useCallback)((function(){S(!1)}),[S]),D=(0,a.useCallback)((function(){L(),_(!0)}),[L,_]),F=(0,a.useCallback)((function(){L(),h((function(e){return e.swapApprovingTransaction?_objectSpread(_objectSpread({},e),{},{swapApprovingTransaction:_objectSpread(_objectSpread({},e.swapApprovingTransaction),{},{status:f.MG.CANCEL})}):e}))}),[L,h]),V=(0,a.useCallback)((0,o.A)((function*(){if(d&&l&&w?.fromAmount&&w?.toAmount&&O.address&&E.address&&O.networkId){S(!0);var e=d.isNative?A.D.DEPOSIT:A.D.WITHDRAW,t={from:O.address,type:e,contract:e===A.D.WITHDRAW?d.contractAddress:l.contractAddress,amount:w?.fromAmount},n={sender:{amount:w?.fromAmount,token:d},receiver:{amount:w.toAmount,token:l},accountAddress:O.address,receivingAddress:E.address,swapBuildResData:{result:w}};yield R({wrappedInfo:t,swapInfo:n,onSuccess:N,onCancel:L}),P({swapFromToken:d,swapToToken:l})}})),[d,l,w,O.address,O.networkId,E.address,S,R,N,L,P]),W=(0,a.useCallback)((i=(0,o.A)((function*(e,t,n){var r=w?.allowanceResult;if(r&&d&&l&&O.networkId&&O.accountInfo?.account?.id&&O.address)try{var o;S(!0);var a={owner:O.address,spender:r.allowanceTarget,amount:e,isMax:!n&&t,tokenInfo:_objectSpread(_objectSpread({},d),{},{isNative:!!d.isNative,address:d.contractAddress,name:null!=(o=d.name)?o:d.symbol})};h((function(o){var a;return _objectSpread(_objectSpread({},o),{},{swapApprovingTransaction:{provider:w?.info.provider,fromToken:d,toToken:l,amount:e,useAddress:null!=(a=O.address)?a:"",spenderAddress:r.allowanceTarget,status:f.MG.PENDING,resetApproveValue:n,resetApproveIsMax:t}})})),yield R({approveInfo:a,onSuccess:z,onCancel:F})}catch(e){S(!1)}})),function(e,t,n){return i.apply(this,arguments)}),[w?.allowanceResult,w?.info.provider,d,l,O.networkId,O.accountInfo?.account?.id,O.address,S,h,R,z,F]);return{buildTx:(0,a.useCallback)((0,o.A)((function*(){if(d&&l&&w?.fromAmount&&p&&w?.toAmount&&O.address&&E.address&&O.networkId)try{S(!0);var e=yield T.A.serviceSwap.fetchBuildTx({fromToken:d,toToken:l,toTokenAmount:w.toAmount,fromTokenAmount:w.fromAmount,slippagePercentage:p.value,receivingAddress:E.address,userAddress:O.address,provider:w?.info.provider,accountId:O.accountInfo?.account?.id,quoteResultCtx:w?.quoteResultCtx});if(e){var t,n,r,o,a;if(e?.swftOrder)o=void 0,r={from:O.address,tokenInfo:_objectSpread(_objectSpread({},e.result.fromTokenInfo),{},{isNative:!!e.result.fromTokenInfo.isNative,address:e.result.fromTokenInfo.contractAddress,name:null!=(a=e.result.fromTokenInfo.name)?a:e.result.fromTokenInfo.symbol}),to:e.swftOrder.platformAddr,amount:e.swftOrder.depositCoinAmt,memo:e.swftOrder.memo};else if(e?.changellyOrder){var s;o=void 0,r={from:O.address,tokenInfo:_objectSpread(_objectSpread({},e.result.fromTokenInfo),{},{isNative:!!e.result.fromTokenInfo.isNative,address:e.result.fromTokenInfo.contractAddress,name:null!=(s=e.result.fromTokenInfo.name)?s:e.result.fromTokenInfo.symbol}),to:e.changellyOrder.payinAddress,amount:e.changellyOrder.amountExpectedFrom,memo:e.changellyOrder.payinExtraId}}else if(e?.thorSwapCallData){var i;o=void 0,r={from:O.address,tokenInfo:_objectSpread(_objectSpread({},e.result.fromTokenInfo),{},{isNative:!!e.result.fromTokenInfo.isNative,address:e.result.fromTokenInfo.contractAddress,name:null!=(i=e.result.fromTokenInfo.name)?i:e.result.fromTokenInfo.symbol}),to:e.thorSwapCallData.vault,opReturn:e.thorSwapCallData.hasStreamingSwap?e.thorSwapCallData.memoStreamingSwap:e.thorSwapCallData.memo,amount:new m.A(e.thorSwapCallData.amount).shiftedBy(-d.decimals).toFixed()}}else if(e?.tx)if(r=void 0,"string"!=typeof e.tx&&e.tx.data){var c,u=(0,y.Si)(new m.A(null!=(c=e.tx.value)?c:0));o=_objectSpread(_objectSpread({},e?.tx),{},{value:u,from:O.address})}else o=e.tx;var g={sender:{amount:w.fromAmount,token:d},receiver:{amount:w.toAmount,token:l},accountAddress:O.address,receivingAddress:E.address,swapBuildResData:e};yield R({transfersInfo:r?[r]:void 0,encodedTx:o,swapInfo:g,onSuccess:N,onCancel:D}),P({swapFromToken:d,swapToToken:l}),I.U.swap.createSwapOrder.swapCreateOrder({swapType:f.If.SWAP,slippage:p.value.toString(),sourceChain:d.networkId,receivedChain:l.networkId,sourceTokenSymbol:d.symbol,receivedTokenSymbol:l.symbol,feeType:null!=(t=w?.fee?.percentageFee?.toString())?t:"0",router:JSON.stringify(null!=(n=w?.routesData)?n:""),isFirstTime:$}),C((function(e){return _objectSpread(_objectSpread({},e),{},{isFirstTimeSwap:!1})}))}else S(!1),_(!0)}catch(e){S(!1),_(!0)}})),[d,l,w?.fromAmount,w?.toAmount,w?.info.provider,w?.quoteResultCtx,w?.fee?.percentageFee,w?.routesData,p,O.address,O.networkId,O.accountInfo?.account?.id,E.address,S,R,N,D,P,$,C,_]),wrappedTx:V,approveTx:W}}var h=n(153763),x=n(82506);function useSwapQuoteLoading(){var[e]=(0,c.iA)(),[t]=(0,c.I4)();return e||t}function useSwapQuoteEventFetching(){var[e]=(0,c.vS)(),[t]=(0,c.mA)();return e>0&&t.length<e}function useSwapActionState(){var e=(0,w.A)(),t=useSwapQuoteLoading(),n=useSwapQuoteEventFetching(),[r]=(0,c.Zr)(),[o]=(0,c.sh)(),[s]=(0,c.VS)(),[i]=(0,c.NE)(),[u]=(0,c.Q8)(),[d]=(0,c.oz)(),[l]=(0,c.rE)();!function useSwapWarningCheck(){var e=(0,v.z)(f.En.FROM),[t]=(0,c.NE)(),[n]=(0,c.Q8)(),[r]=(0,c.Zr)(),[o]=(0,c.VS)(),[s]=(0,c.kz)(),{checkSwapWarning:i}=(0,c.eR)().current,u=(0,a.useRef)({swapFromAddressInfo:{address:void 0,networkId:void 0,accountInfo:void 0}}),d=(0,h.E)(),l=(0,a.useCallback)((function(){u.current.swapFromAddressInfo!==e&&(u.current.swapFromAddressInfo=e)}),[e]);(0,a.useEffect)((function(){d&&(l(),i(u.current.swapFromAddressInfo))}),[l,i,t,o,n,s,r,d])}();var[g]=(0,c.LX)(),[S]=(0,c.kz)(),k=i?.networkId!==u?.networkId,A=(0,v.z)(f.En.FROM),I=(0,v.z)(f.En.TO),[y]=(0,c.SR)(),T=y>p.si||d,j=g.states.some((function(e){return e.alertLevel===f.HM.ERROR})),_=(0,a.useMemo)((function(){return r&&(r.fromTokenInfo.networkId!==i?.networkId||r.toTokenInfo.networkId!==u?.networkId||r.fromTokenInfo.contractAddress!==i?.contractAddress||r.toTokenInfo.contractAddress!==u?.contractAddress)||r?.allowanceResult&&r.allowanceResult.amount!==s}),[i?.contractAddress,i?.networkId,s,r,u?.contractAddress,u?.networkId]),O=(0,x.d)(_,10),E=(0,a.useMemo)((function(){var o={disable:!(!j&&r),label:e.formatMessage({id:b.ETranslations.swap_page_swap_button})};if(A.address&&I.address&&r?.fromAmount===s||(o.disable=!0),t||n)o.label=e.formatMessage({id:b.ETranslations.swap_page_button_fetching_quotes});else{k&&i&&u&&(o.label=e.formatMessage({id:b.ETranslations.swap_page_button_cross_chain})),r&&r.isWrapped&&(o.label=e.formatMessage({id:b.ETranslations.swap_page_button_wrap})),r&&r.allowanceResult&&(o.label=e.formatMessage({id:b.ETranslations.global_approve})),!r||r.toAmount||r.limit||(o.label=e.formatMessage({id:b.ETranslations.swap_page_alert_no_provider_supports_trade}),o.disable=!0),r&&r.toAmount&&!I.address&&(o.label=e.formatMessage({id:b.ETranslations.swap_page_button_enter_a_recipient}),o.disable=!0);var a=new m.A(null!=S?S:0),c=new m.A(s);i&&A.address&&a.lt(c)&&(o.label=e.formatMessage({id:b.ETranslations.swap_page_button_insufficient_balance}),o.disable=!0),i&&u||(o.label=e.formatMessage({id:b.ETranslations.swap_page_button_select_token}),o.disable=!0),s||(o.label=e.formatMessage({id:b.ETranslations.swap_page_button_enter_amount}),o.disable=!0),(T||O)&&(o.label=e.formatMessage({id:b.ETranslations.swap_page_button_refresh_quotes}),o.disable=!1)}return o}),[i,s,j,e,k,T,r,n,t,O,S,A.address,I.address,u]);return{label:E.label,isLoading:o,disabled:E.disable||t||n,approveUnLimit:l,isApprove:!!r?.allowanceResult,isCrossChain:k,shoutResetApprove:!!r?.allowanceResult?.shouldResetApprove,isWrapped:!!r?.isWrapped,isRefreshQuote:(T||O)&&!t&&!n}}var _=n(866063),O=n(309008);function SwapActionsState_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function SwapActionsState_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SwapActionsState_ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SwapActionsState_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const E=(0,a.memo)((function({onBuildTx:e,onApprove:t,onWrapped:n}){var r=(0,w.A)(),[o]=(0,c.NE)(),[i]=(0,c.VS)(),u=(0,v.z)(f.En.FROM),{cleanQuoteInterval:d,quoteAction:l}=(0,c.eR)().current,p=useSwapActionState(),m=useSwapQuoteLoading(),g=(0,a.useCallback)((function(){p.shoutResetApprove?s.Dialog.confirm({onConfirmText:r.formatMessage({id:b.ETranslations.global_continue}),onConfirm:function(){t(i,p.approveUnLimit,!0)},showCancelButton:!0,title:r.formatMessage({id:b.ETranslations.swap_page_provider_approve_usdt_dialog_title}),description:r.formatMessage({id:b.ETranslations.swap_page_provider_approve_usdt_dialog_content}),icon:"ErrorOutline"}):t(i,p.approveUnLimit)}),[i,r,t,p.approveUnLimit,p.shoutResetApprove]),k=(0,s.usePageType)(),{md:A}=(0,s.useMedia)(),I=(0,a.useCallback)((function(){if(p.isRefreshQuote)l(u?.address,u?.accountInfo?.account?.id);else{if(d(),p.isApprove)return void g();if(p.isWrapped)return void n();e()}}),[d,g,e,n,l,p.isApprove,p.isRefreshQuote,p.isWrapped,u?.accountInfo?.account?.id,u?.address]),y=(0,a.useMemo)((function(){var e;return p.isApprove&&!m?(0,S.jsxs)(s.XStack,SwapActionsState_objectSpread(SwapActionsState_objectSpread({gap:"$1"},k!==s.EPageType.modal||A?{pb:"$5"}:{}),{},{children:[(0,S.jsx)(s.Popover,{title:r.formatMessage({id:b.ETranslations.global_approve}),placement:"top-start",renderContent:(0,S.jsx)(s.SizableText,{size:"$bodyLg",$gtMd:{size:"$bodyMd",pt:"$5"},pb:"$5",px:"$5",children:r.formatMessage({id:b.ETranslations.swap_page_swap_steps_1_approve_dialog})}),renderTrigger:(0,S.jsxs)(s.XStack,{userSelect:"none",hoverStyle:{opacity:.5},children:[(0,S.jsx)(s.SizableText,{size:"$bodyMdMedium",pr:"$1",children:r.formatMessage({id:b.ETranslations.swap_page_swap_steps_1},{tokenSymbol:null!=(e=o?.symbol)?e:""})}),(0,S.jsx)(s.Icon,{size:"$5",color:"$iconSubdued",name:"QuestionmarkOutline"})]})}),(0,S.jsx)(s.Icon,{name:"ArrowRightOutline",size:"$5",color:"$iconSubdued"}),(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",children:r.formatMessage({id:b.ETranslations.swap_page_swap_steps_2})})]})):null}),[o?.symbol,r,A,k,m,p.isApprove]),T=(0,a.useMemo)((function(){return(0,S.jsxs)(s.Stack,SwapActionsState_objectSpread(SwapActionsState_objectSpread({flex:1},k!==s.EPageType.modal||A?{}:{flexDirection:"row",justifyContent:p.isApprove&&!m?"space-between":"flex-end",alignItems:"center"}),{},{children:[y,(0,S.jsx)(s.Button,{onPress:I,size:k!==s.EPageType.modal||A?"large":"medium",variant:"primary",disabled:p.disabled||p.isLoading,loading:p.isLoading,children:p.label})]}))}),[y,A,I,k,m,p.disabled,p.isApprove,p.isLoading,p.label]);return(0,S.jsx)(s.YStack,{p:"$5",children:k===s.EPageType.modal||A?(0,S.jsx)(s.Page.Footer,SwapActionsState_objectSpread(SwapActionsState_objectSpread({},k!==s.EPageType.modal||A?{}:{buttonContainerProps:{flex:1}}),{},{confirmButton:T})):T})}));const M=(0,a.memo)((function({alerts:e}){var t,n=(0,a.useMemo)((function(){return e?.sort((function(e){return e.alertLevel===f.HM.ERROR?-1:e.alertLevel===f.HM.INFO?0:1}))}),[e]);return n?.some((function(e){return e.alertLevel===f.HM.ERROR}))?(0,S.jsx)(s.YStack,{gap:"$2.5",children:n.filter((function(e){return e.alertLevel===f.HM.ERROR})).reverse().map((function(e,t){var{message:n}=e;return(0,S.jsx)(s.Alert,{type:"critical",description:n},t)}))}):(0,S.jsx)(s.YStack,{gap:"$2.5",children:null!=(t=n?.map((function(e,t){var{message:n,alertLevel:r}=e;return(0,S.jsx)(s.Alert,{type:r===f.HM.WARNING?"warning":"default",description:n},t)})))?t:null})}));var $=n(622487);const C=(0,a.memo)((function(){var e=(0,w.A)(),t=(0,a.useCallback)((function(){return(0,S.jsx)($.A,{})}),[]),n=(0,a.useCallback)((function(){s.Dialog.confirm({icon:"InfoCircleOutline",showCancelButton:!1,onConfirmText:e.formatMessage({id:b.ETranslations.swap_page_limit_dialog_button}),title:e.formatMessage({id:b.ETranslations.swap_page_limit_dialog_title}),description:e.formatMessage({id:b.ETranslations.swap_page_limit_dialog_content})})}),[e]);return(0,S.jsxs)(s.XStack,{justifyContent:"space-between",children:[(0,S.jsxs)(s.XStack,{gap:"$5",children:[(0,S.jsx)(s.SizableText,{size:"$headingLg",userSelect:"none",children:e.formatMessage({id:b.ETranslations.swap_page_swap})}),(0,S.jsxs)(s.XStack,{opacity:.5,gap:"$1",onPress:n,children:[(0,S.jsx)(s.SizableText,{size:"$headingLg",userSelect:"none",children:e.formatMessage({id:b.ETranslations.swap_page_limit})}),(0,S.jsx)(s.Badge,{badgeSize:"sm",badgeType:"default",children:e.formatMessage({id:b.ETranslations.coming_soon})})]})]}),t()]})}));var R=n(317522);function useSwapApproving_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function useSwapApproving_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?useSwapApproving_ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):useSwapApproving_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=n(318822),N=n(734818),z=n(100009);var L=n(88803),D=n(353203),F=n(625931),V=(n(663522),n(491180));function SwapAccountAddressContainer_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function SwapAccountAddressContainer_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SwapAccountAddressContainer_ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SwapAccountAddressContainer_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function AddressButton({address:e,empty:t,edited:n,loading:r,onPress:o}){var a=(0,w.A)();return(0,S.jsxs)(s.XStack,SwapAccountAddressContainer_objectSpread(SwapAccountAddressContainer_objectSpread({alignItems:"center",gap:"$1",py:"$0.5",px:"$1.5",my:"$-0.5",mx:"$-1.5",borderRadius:"$2",opacity:r?.5:1,disabled:!!r,onPress:o,hitSlop:undefined},o&&{role:"button",userSelect:"none",focusable:!0,hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},focusVisibleStyle:{outlineWidth:2,outlineColor:"$focusRing",outlineStyle:"solid"}}),{},{children:[(0,S.jsxs)(s.XStack,{children:[(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:t?"$textCaution":"$textSubdued",children:t?a.formatMessage({id:b.ETranslations.swap_page_no_address}):e}),n?(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",children:a.formatMessage({id:b.ETranslations.swap_account_to_address_edit})}):null]}),r?(0,S.jsx)(s.Spinner,{size:"small"}):null,o&&t&&!r?(0,S.jsx)(s.Icon,{name:"PlusCircleOutline",size:"$4.5",color:"$iconSubdued",mr:"$-0.5"}):null,!o||t||r?null:(0,S.jsx)(s.Icon,{name:"PencilOutline",size:"$4.5",color:"$iconSubdued",mr:"$-0.5"})]}))}const components_SwapAccountAddressContainer=function({type:e,onToAnotherAddressModal:t}){var n=(0,w.A)(),r=(0,v.z)(e),i=(0,v.z)(e===f.En.FROM?f.En.TO:f.En.FROM),[d]=(0,c.NE)(),[l]=(0,c.Q8)(),[p]=(0,c.Zr)(),[m]=(0,c.dF)(),{createAddress:g}=(0,D.m)(),[{swapToAnotherAccountSwitchOn:k}]=(0,u.useSettingsAtom)(),[A,I]=(0,u.useAccountManualCreatingAtom)(),y=(0,a.useCallback)((0,o.A)((function*(){if(r.accountInfo){var t=r.accountInfo.network?.id,o=r.accountInfo.wallet?.id,a=r.accountInfo.indexedAccount?.id,i=r.accountInfo.deriveType,c={walletId:o,indexedAccountId:a,deriveType:i,networkId:t},u=t&&o&&(i||a)?[t,i,o,a].join("-"):Math.random().toString();try{I((function(e){return SwapAccountAddressContainer_objectSpread(SwapAccountAddressContainer_objectSpread({},e),{},{key:u,isLoading:!0})})),yield g({num:e===f.En.FROM?0:1,account:c,selectAfterCreate:!1}),s.Toast.success({title:n.formatMessage({id:b.ETranslations.swap_page_toast_address_generated})})}catch(e){s.Toast.error({title:n.formatMessage({id:b.ETranslations.swap_page_toast_address_generated_fail})})}finally{I((function(e){return SwapAccountAddressContainer_objectSpread(SwapAccountAddressContainer_objectSpread({},e),{},{isLoading:!1})}))}}})),[g,n,I,r.accountInfo,e]),T=(0,a.useMemo)((function(){var o,a,s;return(d||e!==f.En.FROM)&&(l||e!==f.En.TO)&&(e!==f.En.FROM||r.accountInfo?.wallet&&(!(V.A.isHdWallet({walletId:r.accountInfo?.wallet?.id})||V.A.isHwWallet({walletId:r.accountInfo?.wallet?.id})||V.A.isQrWallet({walletId:r.accountInfo?.wallet?.id}))||r.accountInfo?.indexedAccount)&&(r.address||V.A.isHdWallet({walletId:r.accountInfo?.wallet?.id})||V.A.isHwWallet({walletId:r.accountInfo?.wallet?.id})))?(d&&e===f.En.FROM||l&&e===f.En.TO)&&r.address&&i.address&&r.address===i.address||r.accountInfo?.network?.id===(0,F.V)().onekeyall||i.accountInfo?.network?.id===(0,F.V)().onekeyall||d&&(!l||l&&!i.address)&&e===f.En.FROM&&r.address?null:!r.address&&(V.A.isHdWallet({walletId:r.accountInfo?.wallet?.id})||V.A.isHwWallet({walletId:r.accountInfo?.wallet?.id})||V.A.isQrWallet({walletId:r.accountInfo?.wallet?.id}))?(0,S.jsx)(AddressButton,{empty:!0,loading:A.isLoading,onPress:y}):e!==f.En.FROM&&m&&p?(0,S.jsx)(AddressButton,{onPress:t,address:k&&r.address?`${V.A.shortenAddress({address:null!=(o=r.address)?o:"",leadingLength:8})} ${n.formatMessage({id:b.ETranslations.swap_account_to_address_edit})}`:V.A.shortenAddress({address:null!=(a=r.address)?a:"",leadingLength:8})}):(0,S.jsx)(AddressButton,{address:V.A.shortenAddress({address:null!=(s=r.address)?s:"",leadingLength:8})}):null}),[d,e,l,r.accountInfo?.wallet,r.accountInfo?.indexedAccount,r.accountInfo?.network?.id,r.address,i.address,i.accountInfo?.network?.id,m,p,t,k,n,A.isLoading,y]);return(0,S.jsxs)(s.XStack,{pb:"$1.5",children:[(0,S.jsx)(s.SizableText,{size:"$bodyMdMedium",mr:"$2",userSelect:"none",children:n.formatMessage({id:e===f.En.FROM?b.ETranslations.swap_page_from:b.ETranslations.swap_page_to})}),T]})};const W=(0,a.memo)((function({onAmountChange:e,direction:t,token:n,amountValue:r,selectTokenLoading:o,inputLoading:i,onSelectToken:d,onBalanceMaxPress:l,onToAnotherAddressModal:p,balance:w}){(0,_.ZF)({token:n,type:t});var[g]=(0,u.useSettingsPersistAtom)(),[b]=(0,c.LX)(),[k]=(0,c.I5)(),v=(0,a.useMemo)((function(){var e;if(!n?.price)return"0.0";var t=new m.A(null!=(e=n.price)?e:0),o=new m.A(null!=r?r:0).multipliedBy(t);return o.isNaN()?"0.0":`${o.decimalPlaces(6,m.A.ROUND_DOWN).toFixed()}`}),[r,n?.price]),A=(0,a.useMemo)((function(){return b?.states.some((function(e){return e.inputShowError}))&&t===f.En.FROM}),[t,b]),I=(0,a.useMemo)((function(){if(k&&t===f.En.TO){var e="$textSubdued";return i&&(e="$textPlaceholder"),k.unit===f.GK.NEGATIVE&&(e="$textCritical"),k.unit===f.GK.POSITIVE&&(e="$textSuccess"),(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:e,children:k.value})}return null}),[t,i,k]);return(0,S.jsxs)(s.YStack,{children:[(0,S.jsx)(components_SwapAccountAddressContainer,{type:t,onToAnotherAddressModal:p}),(0,S.jsx)(L.J,{onChange:e,value:r,hasError:A,balanceProps:{value:w,onPress:l},valueProps:{value:v,color:i&&t===f.En.TO?"$textPlaceholder":void 0,currency:g.currencyInfo.symbol,moreComponent:I},inputProps:{placeholder:"0.0",readOnly:t===f.En.TO,color:t===f.En.TO&&i?"$textPlaceholder":void 0},tokenSelectorTriggerProps:{loading:o,selectedNetworkImageUri:n?.networkLogoURI,selectedTokenImageUri:n?.logoURI,selectedTokenSymbol:n?.symbol,onPress:function(){d(t)}},enableMaxAmount:t===f.En.FROM})]})}));const B=(0,a.memo)((function({onSelectToken:e,selectLoading:t,onToAnotherAddressModal:n}){var r,[o,i]=(0,c.VS)(),l=useSwapQuoteLoading(),p=useSwapQuoteEventFetching(),[g]=(0,c.NE)(),[k]=(0,c.Q8)(),[A]=(0,c.WC)(),{alternationToken:I}=(0,c.eR)().current,[y]=(0,c.Zr)(),[T]=(0,c.kz)(),[j]=(0,c.pW)();return function useSwapQuote(){var e=(0,w.A)(),{quoteAction:t,cleanQuoteInterval:n,recoverQuoteInterval:r,quoteEventHandler:o}=(0,c.eR)().current,[i]=(0,c.jH)(),l=(0,v.z)(f.En.FROM),[p]=(0,c.NE)(),[m]=(0,c.Q8)(),[g]=(0,c.DI)(),[b]=(0,c.FR)(),[S,k]=(0,c.VS)(),[A,I]=(0,c.mA)(),[y,T]=(0,c.vS)(),[j]=(0,c.iA)(),{closeQuoteEvent:_}=(0,c.eR)().current,[{swapApprovingTransaction:O}]=(0,u.useInAppNotificationAtom)(),[E]=(0,c.oz)(),M=(0,a.useRef)(E),$=(0,a.useRef)(i),C=(0,a.useRef)(j);C.current!==j&&(C.current=j);var L=(0,a.useRef)(A);L.current!==A&&(L.current=A);var D=(0,a.useRef)(y);D.current!==y&&(D.current=y),$.current!==i&&($.current=i),M.current!==E&&(M.current=E);var F=(0,h.E)(),V=(0,a.useRef)(F);V.current!==F&&(V.current=F);var W=(0,a.useRef)();W.current!==l&&(W.current=l);var B=(0,a.useRef)();B.current!==O&&(B.current=O);var U=(0,x.d)(S,500,{leading:!0}),Q=(0,a.useCallback)((function(){var e=(0,z.mD)(U,p?.decimals);e&&e!==U&&k(e)}),[p?.decimals,U,k]);(0,a.useEffect)((function(){V.current&&(S||t(W.current?.address,W.current?.accountInfo?.account?.id))}),[S,t]),(0,a.useEffect)((function(){g.status||b?n():g.status||"save"!==g.flag?r(W.current?.address,W.current?.accountInfo?.account?.id):t(W.current?.address,W.current?.accountInfo?.account?.id)}),[t,n,r,b,g]),(0,a.useEffect)((function(){V.current&&O&&O.txId&&O.status===f.MG.SUCCESS&&!O.resetApproveValue&&t(W.current?.address,W.current?.accountInfo?.account?.id,O.blockNumber)}),[e,n,t,O]),(0,a.useEffect)((function(){if(V.current&&!(p?.networkId!==W.current?.networkId||(0,N.BQ)({token1:{networkId:p?.networkId,contractAddress:p?.contractAddress},token2:{networkId:m?.networkId,contractAddress:m?.contractAddress}})||$.current?.actionLock&&$.current?.fromTokenAmount===U&&(0,N.BQ)({token1:$.current?.fromToken,token2:{networkId:p?.networkId,contractAddress:p?.contractAddress}})&&(0,N.BQ)({token1:$.current?.toToken,token2:{networkId:m?.networkId,contractAddress:m?.contractAddress}})&&$.current.accountId===W.current?.accountInfo?.account?.id&&$.current?.address===l.address))return Q(),t(W.current?.address,W.current?.accountInfo?.account?.id),function(){n()}}),[n,t,l.address,l.networkId,p?.networkId,p?.contractAddress,m?.networkId,m?.contractAddress,Q,U]),(0,a.useEffect)((function(){if(!V.current&&p?.networkId===W.current?.networkId&&!(0,N.BQ)({token1:{networkId:p?.networkId,contractAddress:p?.contractAddress},token2:{networkId:m?.networkId,contractAddress:m?.contractAddress}}))return Q(),t(W.current?.address,W.current?.accountInfo?.account?.id),function(){n()}}),[l.accountInfo?.deriveType]);var H=(0,s.usePageType)();(0,R.A)(d.V4.Swap,(function(e,t){H!==s.EPageType.modal&&(e?(P.iL.off(P.Tu.SwapQuoteEvent,o),P.iL.on(P.Tu.SwapQuoteEvent,o)):t?((C.current||D.current>0&&L.current.length<D.current)&&(_(),T(0),I([]),k("")),P.iL.off(P.Tu.SwapQuoteEvent,o)):(P.iL.off(P.Tu.SwapQuoteEvent,o),P.iL.on(P.Tu.SwapQuoteEvent,o))),setTimeout((function(){H!==s.EPageType.modal&&(!e||t||B.current?.txId||M.current?n():r(W.current?.address,W.current?.accountInfo?.account?.id))}),100)})),(0,a.useEffect)((function(){H===s.EPageType.modal&&F&&(P.iL.off(P.Tu.SwapQuoteEvent,o),P.iL.on(P.Tu.SwapQuoteEvent,o))}),[F,H,o]),(0,a.useEffect)((function(){setTimeout((function(){H===s.EPageType.modal&&(!F||B.current?.txId||M.current?n():r(W.current?.address,W.current?.accountInfo?.account?.id))}),100)}),[n,F,H,r])}(),(0,v.j)(),function useSwapApproving(){var e=(0,w.A)(),{approvingStateAction:t,cleanApprovingInterval:n}=(0,c.eR)().current,[{swapApprovingTransaction:r},o]=(0,u.useInAppNotificationAtom)(),i=(0,a.useRef)();i.current!==r&&(i.current=r);var{approveTx:l}=useSwapBuildTx(),p=(0,a.useRef)(l);p.current!==l&&(p.current=l);var m=(0,h.E)(),g=(0,a.useRef)(m);g.current!==m&&(g.current=m),(0,a.useEffect)((function(){if(g.current)return r?.txId&&r?.status===f.MG.PENDING?t():n(),r?.status===f.MG.FAILED?s.Toast.error({title:e.formatMessage({id:b.ETranslations.swap_page_toast_approve_failed})}):r?.status===f.MG.CANCEL?s.Toast.error({title:e.formatMessage({id:b.ETranslations.swap_page_toast_approve_canceled})}):r?.status===f.MG.SUCCESS&&(r?.resetApproveValue&&Number(r?.resetApproveValue)>0?p.current?.(r?.resetApproveValue,!!r?.resetApproveIsMax):s.Toast.success({title:e.formatMessage({id:b.ETranslations.swap_page_toast_approve_successful})})),r?.status!==f.MG.FAILED&&r?.status!==f.MG.CANCEL||o((function(e){return useSwapApproving_objectSpread(useSwapApproving_objectSpread({},e),{},{swapApprovingTransaction:void 0})})),function(){n()}}),[t,n,e,o,r?.resetApproveIsMax,r?.resetApproveValue,r?.status,r?.txId]);var S=(0,s.usePageType)();(0,R.A)(d.V4.Swap,(function(e,r){S!==s.EPageType.modal&&(e&&!r&&i.current?.txId&&i.current?.status===f.MG.PENDING?t():n())})),(0,a.useEffect)((function(){S===s.EPageType.modal&&(m&&i.current?.txId&&i.current?.status===f.MG.PENDING?t():n())}),[t,n,m,S])}(),(0,S.jsxs)(s.YStack,{children:[(0,S.jsx)(W,{token:g,direction:f.En.FROM,selectTokenLoading:t,onAmountChange:function(e){(0,z.dM)(e,g?.decimals)&&i(e)},amountValue:o,onBalanceMaxPress:function(){var e=T;if(g?.reservationValue){var t=new m.A(null!=T?T:0),n=new m.A(g.reservationValue);t.minus(n).isGreaterThan(0)&&(e=t.minus(n).toFixed())}i(e)},onSelectToken:e,balance:T}),(0,S.jsxs)(s.YStack,{pt:"$3.5",children:[(0,S.jsx)(s.IconButton,{alignSelf:"flex-end",icon:"SwitchVerOutline",size:"small",zIndex:2,disabled:A.from||A.to,onPress:I,mb:"$-3"}),(0,S.jsx)(W,{token:k,inputLoading:l||p,selectTokenLoading:t,direction:f.En.TO,amountValue:null!=(r=y?.toAmount)?r:"",onSelectToken:e,balance:j,onToAnotherAddressModal:n})]})]})}));const components_SwapCommonInfoItem=function({title:e,value:t,onPress:n,isLoading:r,valueComponent:o,questionMarkContent:i}){var c=(0,a.useMemo)((function(){return(0,S.jsx)(s.Popover,{title:e,renderTrigger:(0,S.jsx)(s.IconButton,{variant:"tertiary",size:"small",icon:"QuestionmarkOutline"}),renderContent:(0,S.jsx)(s.SizableText,{p:"$5",$gtMd:{size:"$bodyMd"},children:i})})}),[i,e]),u=(0,a.useMemo)((function(){return(0,S.jsxs)(s.XStack,{userSelect:"none",hoverStyle:{opacity:.5},alignItems:"center",onPress:n,cursor:n?"pointer":void 0,children:[o||(0,S.jsx)(s.SizableText,{size:"$bodyMdMedium",children:t}),n?(0,S.jsx)(s.Icon,{name:"ChevronRightSmallOutline",mr:"$-1",size:"$5",color:"$iconSubdued"}):null]})}),[n,t,o]);return(0,S.jsxs)(s.XStack,{justifyContent:"space-between",alignItems:"center",children:[(0,S.jsxs)(s.XStack,{children:[(0,S.jsx)(s.SizableText,{userSelect:"none",mr:"$1",size:"$bodyMd",color:"$textSubdued",children:e}),i?c:null]}),(0,S.jsx)(s.XStack,{gap:"$2",children:r?(0,S.jsx)(s.Stack,{py:"$1",children:(0,S.jsx)(s.Skeleton,{h:"$3",w:"$24"})}):u})]})};const components_SwapProviderInfoItem=function({fromToken:e,toToken:t,providerIcon:n,providerName:r,showLock:o,onPress:a,isLoading:i}){var c=(0,w.A)();return(0,S.jsxs)(s.XStack,{justifyContent:"space-between",alignItems:"center",children:[(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",userSelect:"none",children:c.formatMessage({id:b.ETranslations.swap_page_provider_provider})}),i?(0,S.jsx)(s.Stack,{py:"$1",children:(0,S.jsx)(s.Skeleton,{h:"$3",w:"$24"})}):(0,S.jsxs)(s.XStack,{alignItems:"center",userSelect:"none",hoverStyle:{opacity:.5},onPress:a,cursor:a?"pointer":void 0,children:[n&&e&&t?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(s.Image,{source:{uri:n},w:"$5",h:"$5",borderRadius:"$1"}),(0,S.jsx)(s.SizableText,{size:"$bodyMdMedium",ml:"$1",children:null!=r?r:""})]}):null,o?(0,S.jsx)(s.Icon,{name:"LockOutline",color:"$iconSubdued",ml:"$1",size:"$5"}):null,a?(0,S.jsx)(s.Icon,{name:"ChevronRightSmallOutline",size:"$5",color:"$iconSubdued",mr:"$-1"}):null]})]})};const components_SwapQuoteResultRate=function({rate:e,fromToken:t,toToken:n,providerIcon:r,providerName:o,isLoading:i,onOpenResult:c,openResult:u}){var d=(0,w.A)(),[l,p]=(0,a.useState)(!1),f=(0,a.useMemo)((function(){return!new m.g(null!=e?e:0).isZero()}),[e]),g=(0,a.useMemo)((function(){if(!c||!t||!n)return(0,S.jsx)(s.SizableText,{size:"$bodyMdMedium",children:d.formatMessage({id:b.ETranslations.swap_page_provider_provider_insufficient_liquidity})});if(!f)return(0,S.jsx)(s.SizableText,{ml:"$1",size:"$bodyMdMedium",children:d.formatMessage({id:b.ETranslations.swap_page_provider_rate_unavailable})});var r=new m.g(null!=e?e:0);return(0,S.jsx)(s.XStack,{gap:"$2",alignItems:"center",hoverStyle:{opacity:.5},onPress:function(e){e.stopPropagation(),p(!l)},cursor:"pointer",children:(0,S.jsxs)(s.SizableText,{size:"$bodyMdMedium",maxWidth:240,$gtMd:{maxWidth:240},textAlign:"right",children:[`1 ${l?n.symbol.toUpperCase():t.symbol.toUpperCase()} = `,(0,S.jsx)(s.NumberSizeableText,{size:"$bodyMdMedium",formatter:"balance",children:l?new m.g(1).div(r).toFixed():r.toFixed()}),(0,S.jsx)(s.SizableText,{size:"$bodyMdMedium",children:` ${l?t.symbol:n.symbol}`})]})})}),[t,d,l,c,e,f,n]);return(0,S.jsxs)(s.XStack,{justifyContent:"space-between",alignItems:"center",children:[i?(0,S.jsx)(s.Stack,{py:"$0.5",children:(0,S.jsx)(s.Skeleton,{h:"$4",w:"$32"})}):g,(0,S.jsxs)(s.XStack,{alignItems:"center",userSelect:"none",gap:"$1",children:[r&&t&&n&&c?(0,S.jsxs)(s.XStack,{animation:"quick",y:u?"$1":"$0",opacity:u?0:1,children:[(0,S.jsx)(s.Image,{source:{uri:r},w:"$5",h:"$5",borderRadius:"$1"}),(0,S.jsx)(s.SizableText,{numberOfLines:1,size:"$bodyMdMedium",ml:"$1",maxWidth:80,$gtMd:{maxWidth:130},children:null!=o?o:""})]}):null,!i&&c?(0,S.jsx)(s.Stack,{animation:"quick",rotate:u?"180deg":"0deg",children:(0,S.jsx)(s.Icon,{name:"ChevronDownSmallOutline",color:u?"$iconActive":"$iconSubdued",size:"$5"})}):null]})]})};const U=(0,a.memo)((function({onSelectAllowanceValue:e,currentSelectAllowanceValue:t,selectItems:n,onSelectOpenChange:r,isLoading:o}){var i=(0,w.A)(),c=(0,a.useCallback)((function(){return o?(0,S.jsx)(s.Stack,{py:"$1",children:(0,S.jsx)(s.Skeleton,{h:"$3",w:"$24"})}):(0,S.jsxs)(s.XStack,{userSelect:"none",hoverStyle:{opacity:.5},children:[(0,S.jsx)(s.SizableText,{size:"$bodyMdMedium",children:t?.label}),(0,S.jsx)(s.Icon,{size:"$5",color:"$iconSubdued",name:"ChevronRightSmallOutline",mr:"$-1"})]})}),[t?.label,o]);return(0,S.jsxs)(s.XStack,{justifyContent:"space-between",children:[(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",userSelect:"none",children:i.formatMessage({id:b.ETranslations.swap_page_provider_approve_amount})}),(0,S.jsx)(s.Select,{placement:"bottom-end",items:n,value:t?.value,onChange:function(t){e(t)},onOpenChange:r,title:i.formatMessage({id:b.ETranslations.swap_page_provider_approve_amount}),renderTrigger:c})]})}));const Q=(0,a.memo)((function({allowanceResult:e,fromTokenSymbol:t,isLoading:n}){var r=(0,w.A)(),[o,i]=(0,c.rE)(),[,u]=(0,c.FR)(),d=(0,a.useMemo)((function(){return[{label:(0,S.jsx)(s.NumberSizeableText,{size:"$bodyMdMedium",formatter:"balance",formatterOptions:{tokenSymbol:t},children:e.amount}),value:f.KF.PRECISION},{label:r.formatMessage({id:b.ETranslations.swap_page_provider_approve_amount_un_limit}),value:f.KF.UN_LIMIT}]}),[e.amount,t,r]),l=(0,a.useCallback)((function(e){i(e===f.KF.UN_LIMIT)}),[i]);return(0,S.jsx)(U,{currentSelectAllowanceValue:d[o?1:0],onSelectAllowanceValue:l,selectItems:d,isLoading:n,onSelectOpenChange:u})}));var H=n(712784),K=n.n(H);function SwapSlippageContentContainer_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var X=(0,a.memo)((function({swapSlippage:e,onChangeText:t,props:n}){var[o,i]=(0,a.useState)(""),c=(0,a.useRef)(!1),u=(0,a.useCallback)((function(e){(0,z.dM)(e,p.Oz)&&(c.current=/^\d+\.$/.test(e),i(e),t(e))}),[t]),d=(0,a.useMemo)((function(){return new m.g(e.value).decimalPlaces(p.Oz,m.g.ROUND_DOWN).toFixed()}),[e.value]);return(0,a.useEffect)((function(){c.current||i(d)}),[d]),(0,S.jsx)(s.Input,function SwapSlippageContentContainer_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SwapSlippageContentContainer_ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SwapSlippageContentContainer_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({size:"medium",containerProps:{flex:1},value:o,autoFocus:e.key===f.k0.CUSTOM,addOns:[{label:"%"}],textAlign:"left",disabled:e.key===f.k0.AUTO,placeholder:d,onChangeText:u},n))}));const q=(0,a.memo)((function({swapSlippage:e,onSave:t,autoValue:n}){var[r,o]=(0,a.useState)(e),i=(0,w.A)(),[c,u]=(0,a.useState)({status:f.nC.NORMAL,message:""}),d=(0,a.useCallback)(K()((function(e){var t=new m.g(e);t.isNaN()||t.isNegative()||t.gt(p.qm)?u({status:f.nC.ERROR,message:i.formatMessage({id:b.ETranslations.slippage_tolerance_error_message})}):(o({key:f.k0.CUSTOM,value:t.toNumber()}),t.lte(p.SF)?u({status:f.nC.WRONG,message:i.formatMessage({id:b.ETranslations.slippage_tolerance_warning_message_2},{number:p.SF})}):t.gte(p.Rq)?u({status:f.nC.WRONG,message:i.formatMessage({id:b.ETranslations.slippage_tolerance_warning_message_1},{number:p.Rq})}):u({status:f.nC.NORMAL,message:""}))}),350),[]);return(0,S.jsxs)(s.YStack,{gap:"$4",children:[(0,S.jsx)(s.SegmentControl,{fullWidth:!0,value:r.key,options:p.dI.map((function(e){return{label:i.formatMessage({id:e.key===f.k0.AUTO?b.ETranslations.slippage_tolerance_switch_auto:b.ETranslations.slippage_tolerance_switch_custom}),value:e.key}})),onChange:function(t){o({key:t,value:t===f.k0.AUTO?n:e.value})}}),r.key!==f.k0.CUSTOM?(0,S.jsx)(X,{swapSlippage:r,onChangeText:d}):null,r.key===f.k0.CUSTOM?(0,S.jsxs)(s.XStack,{gap:"$2.5",children:[(0,S.jsx)(X,{swapSlippage:r,onChangeText:d}),(0,S.jsx)(s.XStack,{children:p.RW.map((function(e,t){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(s.Button,{variant:"secondary",size:"medium",borderTopRightRadius:2!==t?0:"$2",borderBottomRightRadius:2!==t?0:"$2",borderTopLeftRadius:0!==t?0:"$2",borderBottomLeftRadius:0!==t?0:"$2",onPress:function(){u({status:f.nC.NORMAL,message:""}),o({key:f.k0.CUSTOM,value:e})},children:`${e}${t===p.RW.length-1?"  ":""}%`},e),t!==p.RW.length-1?(0,S.jsx)(s.Divider,{vertical:!0}):null]})}))})]}):null,r.key===f.k0.AUTO?(0,S.jsx)(s.SizableText,{size:"$bodyMd",color:"$textSubdued",children:i.formatMessage({id:b.ETranslations.slippage_tolerance_description})}):null,r.key!==f.k0.AUTO&&c.status!==f.nC.NORMAL?(0,S.jsx)(s.SizableText,{size:"$bodySmMedium",color:c.status===f.nC.ERROR?"$textCritical":"$textCaution",children:c.message}):null,(0,S.jsx)(s.Dialog.Footer,{showCancelButton:!1,onConfirmText:i.formatMessage({id:b.ETranslations.slippage_tolerance_button_save}),confirmButtonProps:{variant:"primary",disabled:r.key===f.k0.CUSTOM&&c.status===f.nC.ERROR},onConfirm:function({close:e}){t(r,e)}})]})}));const G=(0,a.memo)((function({isLoading:e,onPress:t}){var n=(0,w.A)(),[{slippageItem:r}]=(0,c.H_)(),o=(0,a.useMemo)((function(){return new m.A(r.value).decimalPlaces(p.Oz,m.A.ROUND_DOWN).toFixed()}),[r.value]),i=(0,a.useMemo)((function(){return n.formatMessage({id:r.key===f.k0.AUTO?b.ETranslations.swap_page_provider_slippage_auto:b.ETranslations.swap_page_provider_custom},{number:o})}),[o,n,r.key]),u=(0,a.useMemo)((function(){return(0,S.jsx)(s.SizableText,{size:"$bodyMdMedium",color:r.value>p.Rq?"$textCritical":"$text",children:i})}),[i,r.value]);return(0,S.jsx)(components_SwapCommonInfoItem,{title:n.formatMessage({id:b.ETranslations.swap_page_provider_slippage_tolerance}),isLoading:e,onPress:t,questionMarkContent:n.formatMessage({id:b.ETranslations.slippage_tolerance_popover}),valueComponent:u})}));const Z=(0,a.memo)((function({onOpenProviderList:e,quoteResult:t}){var n,r,o,[i,d]=(0,a.useState)(!1),[l]=(0,c.NE)(),[p]=(0,c.Q8)(),[g]=(0,c.VS)(),[k]=(0,u.useSettingsPersistAtom)(),v=useSwapQuoteLoading(),A=(0,w.A)(),[,I]=(0,c.DI)(),[{slippageItem:y,autoValue:T}]=(0,c.H_)(),[,j]=(0,c.$E)(),[,h]=(0,c.AF)(),_=(0,a.useRef)(null),O=(0,a.useCallback)((function(e,t){h(e.key),e.key===f.k0.CUSTOM&&j(e.value),t({flag:"save"})}),[j,h]),E=(0,a.useCallback)((function(){_.current=s.Dialog.show({title:A.formatMessage({id:b.ETranslations.slippage_tolerance_title}),renderContent:(0,S.jsx)(q,{swapSlippage:y,autoValue:T,onSave:O}),onOpen:function(){I({status:!0})},onClose:function(e){I({status:!1,flag:e?.flag})}})}),[A,y,T,O,I]),M=(0,x.d)(g,500,{leading:!0});return!l||!p||new m.A(g).isNaN()||new m.A(g).isZero()?null:l&&p&&!new m.A(M).isZero()&&!new m.A(M).isNaN()?(0,S.jsx)(s.Accordion,{type:"single",collapsible:!0,children:(0,S.jsxs)(s.Accordion.Item,{value:"1",children:[(0,S.jsx)(s.Accordion.Trigger,{unstyled:!0,borderWidth:0,bg:"$transparent",p:"$0",cursor:"pointer",children:function({open:e}){var n,r;return(0,S.jsx)(components_SwapQuoteResultRate,{rate:t?.instantRate,fromToken:l,toToken:p,providerIcon:null!=(n=t?.info.providerLogo)?n:"",providerName:null!=(r=t?.info.providerName)?r:"",isLoading:v,onOpenResult:t?.info.provider?function(){return d(!i)}:void 0,openResult:e})}}),(0,S.jsx)(s.Accordion.HeightAnimator,{animation:"quick",children:(0,S.jsxs)(s.Accordion.Content,{gap:"$4",p:"$0",animation:"quick",enterStyle:{opacity:0},exitStyle:{opacity:0},children:[(0,S.jsx)(s.Divider,{mt:"$4"}),t?.allowanceResult?(0,S.jsx)(Q,{allowanceResult:t?.allowanceResult,fromTokenSymbol:null!=(n=l?.symbol)?n:"",isLoading:v}):null,t?.info.provider?(0,S.jsx)(components_SwapProviderInfoItem,{providerIcon:null!=(r=t?.info.providerLogo)?r:"",providerName:null!=(o=t?.info.providerName)?o:"",isLoading:v,fromToken:l,toToken:p,showLock:!!t?.allowanceResult,onPress:t?.info.provider?function(){e?.()}:void 0}):null,!t?.toAmount||t?.allowanceResult||t?.unSupportSlippage?null:(0,S.jsx)(G,{isLoading:v,onPress:E}),t?.fee?.estimatedFeeFiatValue?(0,S.jsx)(components_SwapCommonInfoItem,{title:A.formatMessage({id:b.ETranslations.swap_page_provider_est_network_fee}),isLoading:v,valueComponent:(0,S.jsx)(s.NumberSizeableText,{size:"$bodyMdMedium",formatter:"value",formatterOptions:{currency:k.currencyInfo.symbol},children:t.fee?.estimatedFeeFiatValue})}):null]})})]})}):void 0}));function SwapMainLand_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function SwapMainLand_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SwapMainLand_ownKeys(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SwapMainLand_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var SwapMainLoad=function({swapInitParams:e,pageType:t}){var n,r,{buildTx:m,approveTx:w,wrappedTx:g}=useSwapBuildTx(),{fetchLoading:b}=(0,_.FI)(e),A=(0,i.A)(),[I]=(0,c.Zr)(),[y]=(0,c.LX)(),T=(0,v.z)(f.En.TO),j=useSwapQuoteLoading(),h=useSwapQuoteEventFetching(),[{swapRecentTokenPairs:x}]=(0,u.useInAppNotificationAtom)(),[O]=(0,c.VS)(),{selectFromToken:$,selectToToken:R}=(0,c.eR)().current,[P]=(0,c.WC)(),N=(0,a.useCallback)((function(e){A.pushModal(d.ry.SwapModal,{screen:l.u.SwapTokenSelect,params:{type:e,storeName:t===s.EPageType.modal?u.EJotaiContextStoreNames.swapModal:u.EJotaiContextStoreNames.swap}})}),[A,t]),z=(0,a.useCallback)((function({fromToken:e,toToken:t}){$(e),R(t)}),[$,R]),L=(0,a.useCallback)((function(){A.pushModal(d.ry.SwapModal,{screen:l.u.SwapProviderSelect,params:{storeName:t===s.EPageType.modal?u.EJotaiContextStoreNames.swapModal:u.EJotaiContextStoreNames.swap}})}),[A,t]),D=(0,a.useCallback)((function(){A.pushModal(d.ry.SwapModal,{screen:l.u.SwapToAnotherAddress,params:{address:T.address,storeName:t===s.EPageType.modal?u.EJotaiContextStoreNames.swapModal:u.EJotaiContextStoreNames.swap}})}),[A,t,T.address]),F=(0,a.useCallback)((0,o.A)((function*(){yield m()})),[m]),V=(0,a.useCallback)((r=(0,o.A)((function*(e,t,n){n?yield w(p.XU,t,e):yield w(e,t)})),function(e,t,n){return r.apply(this,arguments)}),[w]),W=(0,a.useCallback)((0,o.A)((function*(){yield g()})),[g]);return(0,S.jsx)(s.ScrollView,{children:(0,S.jsxs)(s.YStack,{testID:"swap-content-container",flex:1,marginHorizontal:"auto",width:"100%",maxWidth:t===s.EPageType.modal?"100%":480,children:[(0,S.jsxs)(s.YStack,{pt:"$2.5",px:"$5",pb:"$5",gap:"$5",flex:1,$gtMd:{flex:"unset",pt:"$5"},children:[t!==s.EPageType.modal?(0,S.jsx)(C,{}):null,(0,S.jsx)(B,{onSelectToken:N,selectLoading:b,onToAnotherAddressModal:D}),(0,S.jsx)(Z,{onOpenProviderList:L,quoteResult:I}),!(y.states.length>0)||j||h||y.quoteId!==(null!=(n=I?.quoteId)?n:"")||P.from||P.to?null:(0,S.jsx)(M,{alerts:y.states}),(0,S.jsx)(k,{onSelectTokenPairs:z,tokenPairs:x,fromTokenAmount:O})]}),(0,S.jsx)(E,{onBuildTx:F,onApprove:V,onWrapped:W})]})})};const SwapMainLand=function(e){return(0,S.jsx)(O.o,{storeName:e?.pageType===s.EPageType.modal?u.EJotaiContextStoreNames.swapModal:u.EJotaiContextStoreNames.swap,children:(0,S.jsx)(SwapMainLoad,SwapMainLand_objectSpread({},e))})}}}]);